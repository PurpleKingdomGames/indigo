<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Shaders Overview</title>
  
  
  <meta name="description" content="A 2D Pixel Art FP game engine for Scala."/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/svg+xml" href="../../img/indigo_logo_solid.svg"/>
  
  <link rel="icon" sizes="64x64" type="image/svg+xml" href="../../img/indigo_logo_solid.svg"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../../helium/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../../css/custom.css" />
  <script src="../../helium/laika-helium.js"></script>
    <script src="../../01-quickstart/hello-indigo.md.js"></script>
    <script src="../../01-quickstart/mdoc.js"></script>
    <script src="../../03-gameloop/frame-context.md.js"></script>
    <script src="../../03-gameloop/mdoc.js"></script>
    <script src="../../03-gameloop/outcome.md.js"></script>
    <script src="../../06-presentation/materials.md.js"></script>
    <script src="../../06-presentation/cameras.md.js"></script>
    <script src="../../06-presentation/lighting.md.js"></script>
    <script src="../../06-presentation/depth.md.js"></script>
    <script src="../../06-presentation/clones-and-mutants.md.js"></script>
    <script src="../../06-presentation/animation.md.js"></script>
    <script src="../../06-presentation/layers.md.js"></script>
    <script src="../../06-presentation/audio.md.js"></script>
    <script src="../../06-presentation/scene-update-fragment.md.js"></script>
    <script src="../../06-presentation/boundaries.md.js"></script>
    <script src="../../06-presentation/shapes.md.js"></script>
    <script src="../../06-presentation/text-and-fonts.md.js"></script>
    <script src="../../06-presentation/mdoc.js"></script>
    <script src="../../08-time/signals.md.js"></script>
    <script src="../../08-time/mdoc.js"></script>
    <script src="../../08-time/time-varying-values.md.js"></script>
    <script src="../blending.md.js"></script>
    <script src="../mdoc.js"></script>
    <script src="../shaders-overview.md.js"></script>
    <script src="../../09-uicomponents/button.md.js"></script>
    <script src="../../09-uicomponents/input-field.md.js"></script>
    <script src="../../09-uicomponents/hit-area.md.js"></script>
    <script src="../../09-uicomponents/radio-button.md.js"></script>
    <script src="../../09-uicomponents/mdoc.js"></script>
    <script src="../../04-organisation/scene-management.md.js"></script>
    <script src="../../04-organisation/boot-and-start-up.md.js"></script>
    <script src="../../04-organisation/subsystems.md.js"></script>
    <script src="../../04-organisation/mdoc.js"></script>
    <script src="../../02-guides/mdoc.js"></script>
    <script src="../../02-guides/howto-fire-shader.md.js"></script>
    <script src="../../02-guides/howto-custom-entity.md.js"></script>
    <script src="../../05-platform/assets.md.js"></script>
    <script src="../../05-platform/logging.md.js"></script>
    <script src="../../05-platform/mdoc.js"></script>
    <script src="../../05-platform/input-handling.md.js"></script>
    <script src="../../10-information/key-concepts.md.js"></script>
    <script src="../../10-information/antipatterns.md.js"></script>
    <script src="../../10-information/mdoc.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="../../"><img src="../../img/indigo_logo_solid_text.svg" alt="Homepage" title="Indigo" width="150" height="50"></a>

  <div class="row links">
    
    <a class="button-link" href="https://discord.gg/b5CD47g">Discord</a>
    
    <a class="button-link" href="/api">API</a>
    
    <a class="button-link" href="https://github.com/PurpleKingdomGames/indigo">Github</a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="button-link" href="https://discord.gg/b5CD47g">Discord</a>
    
    <a class="button-link" href="/api">API</a>
    
    <a class="button-link" href="https://github.com/PurpleKingdomGames/indigo">Github</a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../table-of-content/">Contents</a></li>
    <li class="level1 nav-header">Setup &amp; Configuration</li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/examples/">Examples, Demos, and References</a></li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/extensions-and-libs/">Extensions, Libraries, and Related Projects</a></li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/hello-indigo/">Hello, Indigo!</a></li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/project-templates/">Mill &amp; SBT Templates</a></li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/quickstart/">Quick start</a></li>
    <li class="level1 nav-header">Guides</li>
    <li class="level2 nav-leaf"><a href="../../02-guides/howto-custom-entity/">How to make a custom entity</a></li>
    <li class="level2 nav-leaf"><a href="../../02-guides/howto-fire-shader/">How to write a fire shader</a></li>
    <li class="level2 nav-leaf"><a href="../../02-guides/howto-hello-indigo-tyrian/">How to make a responsive UI using Tyrian</a></li>
    <li class="level2 nav-leaf"><a href="../../02-guides/howto-indigo-game/">Converting <code>IndigoSandbox</code> to <code>IndigoGame</code></a></li>
    <li class="level1 nav-header">Gameloop</li>
    <li class="level2 nav-leaf"><a href="../../03-gameloop/events/">Events</a></li>
    <li class="level2 nav-leaf"><a href="../../03-gameloop/frame-context/">Frame context</a></li>
    <li class="level2 nav-leaf"><a href="../../03-gameloop/outcome/">Outcome Type</a></li>
    <li class="level1 nav-header">Organisation</li>
    <li class="level2 nav-leaf"><a href="../../04-organisation/boot-and-start-up/">Boot &amp; Start Up</a></li>
    <li class="level2 nav-leaf"><a href="../../04-organisation/game-entry-points/">Game Entry Points</a></li>
    <li class="level2 nav-leaf"><a href="../../04-organisation/scene-management/">What are Scenes?</a></li>
    <li class="level2 nav-leaf"><a href="../../04-organisation/subsystems/">What SubSystems are</a></li>
    <li class="level1 nav-header">Platform &amp; IO</li>
    <li class="level2 nav-leaf"><a href="../../05-platform/assets/">Assets &amp; Asset Loading</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/configuration/">Game Configuration</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/cross-platform-publishing/">Cross Platform Publishing</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/importers/">File Importers</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/input-handling/">Input Handling</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/loading-and-saving-data/">Loading &amp; Saving Data</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/logging/">Logging</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/networking/">Networking</a></li>
    <li class="level1 nav-header">Presentation</li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/animation/">Animation</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/audio/">Audio</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/boundaries/">Boundaries</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/cameras/">Cameras</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/clones-and-mutants/">Clones &amp; Mutants</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/depth/">Depth</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/layers/">Layers</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/lighting/">Lighting</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/materials/">Materials</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/primitives/">Primitives &amp; Building Blocks</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/scene-update-fragment/">SceneUpdateFragment</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/shapes/">Shapes</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/text-and-fonts/">Text &amp; Fonts</a></li>
    <li class="level1 nav-header">Shaders</li>
    <li class="level2 nav-leaf"><a href="../blending/">Blending</a></li>
    <li class="level2 nav-leaf"><a href="../constants/">Shader Constants, Variables, and Outputs</a></li>
    <li class="level2 nav-leaf"><a href="../premultiplied-alpha/">Premultiplied Alpha</a></li>
    <li class="level2 active nav-leaf"><a href="#">Shaders Overview</a></li>
    <li class="level1 nav-header">Time</li>
    <li class="level2 nav-leaf"><a href="../../08-time/gametime/">GameTime</a></li>
    <li class="level2 nav-leaf"><a href="../../08-time/signals/">Signals &amp; Signal Functions</a></li>
    <li class="level2 nav-leaf"><a href="../../08-time/time-varying-values/">Time Varying Values</a></li>
    <li class="level1 nav-header">UI Components</li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/button/">Buttons</a></li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/hit-area/">Hit Areas</a></li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/input-field/">Input Fields</a></li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/radio-button/">Radio Buttons</a></li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/ui-components/">UI Components</a></li>
    <li class="level1 nav-header">Misc</li>
    <li class="level2 nav-leaf"><a href="../../10-information/alternatives/">Alternatives to Indigo</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/antipatterns/">Anti-Patterns</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/glossary/">Glossary</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/key-concepts/">Key Concepts</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/model-viewmodel-view/">Model, ViewModel, &amp; View</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/motivation-and-constraints/">Motivation &amp; Constraints</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/performance/">Performance</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/prior-art/">Prior Art</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/rendering-technology/">Rendering Technology</a></li>
    <li class="level1 nav-header">Physics</li>
    <li class="level2 nav-leaf"><a href="../../11-physics/physics-overview/">Physics Overview</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Shaders Overview</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#what-is-a-shader">What is a shader?</a></li>
    <li class="level1 nav-leaf"><a href="#aim-of-the-shader-docs">Aim of the shader docs</a></li>
    <li class="level1 nav-leaf"><a href="#how-to-get-started-with-shaders">How to get started with Shaders</a></li>
    <li class="level1 nav-node"><a href="#entity-vs-blend-shaders">Entity vs Blend Shaders</a></li>
    <li class="level2 nav-leaf"><a href="#functions-available-for-override">Functions available for override</a></li>
    <li class="level2 nav-leaf"><a href="#constants-and-variables">Constants and variables</a></li>
    <li class="level1 nav-leaf"><a href="#loading-external-shader-files">Loading external shader files</a></li>
    <li class="level1 nav-leaf"><a href="#using-shaders-in-your-scene">Using shaders in your scene</a></li>
    <li class="level1 nav-leaf"><a href="#providing-data-to-your-shaders">Providing data to your shaders</a></li>
    <li class="level1 nav-leaf"><a href="#uniformblock-ubo-data-packing-rules"><code>UniformBlock</code> / UBO Data Packing Rules</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="shaders-overview" class="title">Shaders Overview</h1>
        <blockquote>Please be aware that these docs are out of date, as they do not yet include information about Ultraviolet, our shader library.</blockquote>
        
        <h2 id="what-is-a-shader" class="section"><a class="anchor-link left" href="#what-is-a-shader"><i class="icofont-laika link">&#xef71;</i></a>What is a shader?</h2>
        <p>A shader program is a compiled computer program executed on your graphics card that instructs the GPU &quot;where&quot; on the screen to draw to, and &quot;what&quot; to draw when it gets there. In the case of Indigo which uses WebGL 2.0, a shader is made up of a pair of programs, called the vertex (where) and fragment (what) programs.</p>
        <blockquote>The terms &quot;shader&quot;, &quot;program&quot;, and &quot;shader program&quot; are used somewhat inter-changeably here.</blockquote>
        
        <h2 id="aim-of-the-shader-docs" class="section"><a class="anchor-link left" href="#aim-of-the-shader-docs"><i class="icofont-laika link">&#xef71;</i></a>Aim of the shader docs</h2>
        <p>Shaders are a big subject and beyond the scope of this documentation site, the aim here is just to give you enough information to get you started with shaders in Indigo (which have a particular flavour), not to teach you how to write shaders in general.</p>
        
        <h2 id="how-to-get-started-with-shaders" class="section"><a class="anchor-link left" href="#how-to-get-started-with-shaders"><i class="icofont-laika link">&#xef71;</i></a>How to get started with Shaders</h2>
        <p>There is a brief introduction to using shaders in your project as part of the <a href="../../02-guides/howto-custom-entity/">&quot;how to create a custom entity&quot;</a> guide that we recommend you read first, which also has an accompanying <a href="https://github.com/PurpleKingdomGames/indigo-examples/tree/master/howto/custom-entity">example repo</a>.</p>
        <p>There is a follow on tutorial to the one above than explains <a href="../../02-guides/howto-fire-shader/">how to make a fire shader</a> that you may also find useful.</p>
        
        <h2 id="entity-vs-blend-shaders" class="section"><a class="anchor-link left" href="#entity-vs-blend-shaders"><i class="icofont-laika link">&#xef71;</i></a>Entity vs Blend Shaders</h2>
        <p>Indigo has two distinct flavours of shader.</p>
        <ol class="arabic">
          <li><code>Entity shaders</code> are used to draw individual items / entities on the screen.</li>
          <li>Blend shaders are used in the <a href="../blending/">blending process</a> to tell Indigo how to merge layers together.</li>
        </ol>
        <p>They both work in a similar way, but there are differences.</p>
        
        <h3 id="functions-available-for-override" class="section"><a class="anchor-link left" href="#functions-available-for-override"><i class="icofont-laika link">&#xef71;</i></a>Functions available for override</h3>
        <p>A large part of what you&#39;re doing when writing shaders is providing implementations for shader functions that are called at different stages of the shading process. Both types of shader support a <code>vertex</code> and <code>fragment</code> stage, but entity shaders also have <code>prepare</code>, <code>light</code>, and <code>composite</code> which are used for lighting.</p>
        <p>The default implementations are simply blank function calls, as follows:</p>
        <p><strong>Entity shader functions</strong></p>
        <pre class="keep-together pdf epub"><code class="glsl">void vertex(){}
void fragment(){}
void prepare(){}
void light(){}
void composite(){}</code></pre>
        <p><strong>Blend shader functions</strong></p>
        <pre class="keep-together pdf epub"><code class="glsl">void vertex(){}
void fragment(){}</code></pre>
        <p><strong>Function uses</strong></p>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Sequential order</th>
              <th>description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>vertex</code></td>
              <td>1</td>
              <td>Used to modify the space on the screen the entity occupies, and to pass data to the fragment shader.</td>
            </tr>
            <tr>
              <td><code>fragment</code></td>
              <td>2</td>
              <td>Tells Indigo what color each pixel needs to be.</td>
            </tr>
            <tr>
              <td><code>prepare</code></td>
              <td>3</td>
              <td>Called before <code>light</code>, prepare gives you an opportunity to set up any data or functions needed for the lighting process.</td>
            </tr>
            <tr>
              <td><code>light</code></td>
              <td>4..4n</td>
              <td>Called before <code>composite</code>, <code>light</code> is called once per light in the scene, and is used to build up per pixel lighting data separate from the colour data that results from <code>fragment</code>.</td>
            </tr>
            <tr>
              <td><code>composite</code></td>
              <td>5</td>
              <td>Called last, <code>composite</code> is used to override how lighting information is combined with unlit pixel color data.</td>
            </tr>
          </tbody>
        </table>
        <p>To override a function you simply need to declare it. In an <code>Source</code> shader type, this could be done as follows:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">indigo</span><span>.*

</span><span class="keyword">val</span><span> </span><span class="identifier">shader</span><span>: </span><span class="type-name">EntityShader</span><span> =
  </span><span class="type-name">EntityShader</span><span>
    .</span><span class="type-name">Source</span><span>(</span><span class="type-name">ShaderId</span><span>(</span><span class="string-literal">&quot;my-colored-shader&quot;</span><span>))
    .</span><span class="identifier">withFragmentProgram</span><span>(
      </span><span class="string-literal">&quot;&quot;&quot;
      |void fragment() {
      |  COLOR = vec4(0.0, 1.0, 0.0, 1.0);
      |}
      |&quot;&quot;&quot;</span><span>.</span><span class="identifier">stripMargin</span><span>
      )</span></code></pre>
        
        <h4 id="external-source-files" class="section"><a class="anchor-link left" href="#external-source-files"><i class="icofont-laika link">&#xef71;</i></a>External source files</h4>
        <p>External files are more convenient for shader editing, allowing you to use tools like linters, and Indigo has a particular way of structuring them. The idea was to allow you as far as possible to utilise all existing GLSL editing tools, so the process below is designed not to interfere with them.</p>
        <p>In an external shader file, we need to tell Indigo which parts of the file to use where, like this:</p>
        <pre class="keep-together pdf epub"><code class="glsl">//&lt;indigo-fragment&gt;
void fragment() {
  COLOR = vec4(0.0, 1.0, 0.0, 1.0);
}
//&lt;/indigo-fragment&gt;</code></pre>
        <p>Indigo uses tags like the one above to do this, the tags are simply as follows (note that the <code>//</code> comments are significant so that GLSL tools ignore them):</p>
        <pre class="keep-together pdf epub"><code class="glsl">//&lt;indigo-&quot;function to override&quot;&gt;
void &quot;function to override&quot;() {
  ..
}
//&lt;/indigo-&quot;function to override&quot;&gt;</code></pre>
        <p>Any code declared inside the &quot;tags&quot; will be inserted into the final shader, and you are not limited to declaring only the required override function, you could declare other functions and variables as needed.</p>
        <p>Another useful trick is declaring variables outside the tags. If for example, you&#39;d like to use Indigo&#39;s in-built <code>UV</code> variable, you can do this:</p>
        <pre class="keep-together pdf epub"><code class="glsl">vec2 UV;

//&lt;indigo-fragment&gt;
void fragment() {
  COLOR = vec4(UV, 0.0, 1.0);
}
//&lt;/indigo-fragment&gt;</code></pre>
        <p>This allows the GLSL linting tools to pass since the variable is declared before it is used, but Indigo will ignore it and use the real one instead.</p>
        
        <h3 id="constants-and-variables" class="section"><a class="anchor-link left" href="#constants-and-variables"><i class="icofont-laika link">&#xef71;</i></a>Constants and variables</h3>
        <p>The different shader types also have some shared and some specific constants available to them, for example entity shaders read texture colours from the <code>CHANNEL_0</code>, <code>CHANNEL_1</code>, <code>CHANNEL_2</code> and <code>CHANNEL_3</code> variables, but blend shaders use <code>SRC</code> and <code>DST</code> instead.</p>
        <p>A complete list is available on the <a href="../constants/">&quot;Shader Constants, Variables, and Outputs&quot;</a> page.</p>
        
        <h2 id="loading-external-shader-files" class="section"><a class="anchor-link left" href="#loading-external-shader-files"><i class="icofont-laika link">&#xef71;</i></a>Loading external shader files</h2>
        <p>Getting an external shader into Indigo is no different from loading any other text asset:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">assets</span><span>: </span><span class="type-name">Set</span><span>[</span><span class="type-name">AssetType</span><span>] =
  </span><span class="type-name">Set</span><span>(
    </span><span class="type-name">AssetType</span><span>.</span><span class="type-name">Text</span><span>(</span><span class="type-name">AssetName</span><span>(</span><span class="string-literal">&quot;my vertex shader&quot;</span><span>), </span><span class="type-name">AssetPath</span><span>(</span><span class="string-literal">&quot;assets/shader.vert&quot;</span><span>)),
    </span><span class="type-name">AssetType</span><span>.</span><span class="type-name">Text</span><span>(</span><span class="type-name">AssetName</span><span>(</span><span class="string-literal">&quot;my fragment shader&quot;</span><span>), </span><span class="type-name">AssetPath</span><span>(</span><span class="string-literal">&quot;assets/shader.frag&quot;</span><span>))
  )</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run1&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        <blockquote>Note, best practice is to do what is shown in this example and have two shader files with the same name, one with a <code>.vert</code> and the other with a <code>.frag</code> extension. These are standard shader file names that your GLSL editor of choice will understand. Technically they could all be in the same file, but if you need to pass data from your vertex to your fragment shader (using varyings) then you&#39;ll run into problems with conflicting variable names, e.g. you&#39;d have to declare <code>out vec4 mydata;</code> and <code>in vec4 mydata;</code> in the same file, which a linter won&#39;t like.</blockquote>
        <p>Here we&#39;re loading two shader files with potentially a complete set of function overrides, but please note that you only need to supply what you need. If you only need a fragment shader that overrides <code>void fragment(){}</code>, you can just supply that and Indigo will use defaults for the others.</p>
        <p>Next we need to build our shader:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">object</span><span> </span><span class="type-name">CustomShader</span><span>:
  </span><span class="keyword">val</span><span> </span><span class="identifier">vertAsset</span><span>: </span><span class="type-name">AssetName</span><span> = </span><span class="type-name">AssetName</span><span>(</span><span class="string-literal">&quot;my vertex shader&quot;</span><span>)
  </span><span class="keyword">val</span><span> </span><span class="identifier">fragAsset</span><span>: </span><span class="type-name">AssetName</span><span> = </span><span class="type-name">AssetName</span><span>(</span><span class="string-literal">&quot;my fragment shader&quot;</span><span>)

  </span><span class="keyword">val</span><span> </span><span class="identifier">shader</span><span>: </span><span class="type-name">EntityShader</span><span>.</span><span class="type-name">External</span><span> =
    </span><span class="type-name">EntityShader</span><span>
      .</span><span class="type-name">External</span><span>(</span><span class="type-name">ShaderId</span><span>(</span><span class="string-literal">&quot;my shader&quot;</span><span>))
      .</span><span class="identifier">withVertexProgram</span><span>(</span><span class="identifier">vertAsset</span><span>)
      .</span><span class="identifier">withFragmentProgram</span><span>(</span><span class="identifier">fragAsset</span><span>)
      .</span><span class="identifier">withLightProgram</span><span>(</span><span class="identifier">fragAsset</span><span>)</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run2&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        <p>Finally we need to tell Indigo about these shaders, or we won&#39;t be able to use them:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span>    </span><span class="type-name">Outcome</span><span>(
      </span><span class="type-name">BootResult</span><span>.</span><span class="identifier">noData</span><span>(</span><span class="type-name">GameConfig</span><span>.</span><span class="keyword">default</span><span>)
        .</span><span class="identifier">withShaders</span><span>(</span><span class="type-name">CustomShader</span><span>.</span><span class="identifier">shader</span><span>)
    )</span></code></pre>
        <blockquote>Note that shaders must be fully declared during game boot up, you cannot add more later.</blockquote>
        
        <h2 id="using-shaders-in-your-scene" class="section"><a class="anchor-link left" href="#using-shaders-in-your-scene"><i class="icofont-laika link">&#xef71;</i></a>Using shaders in your scene</h2>
        <p>Custom shaders are generally expected to be used in conjunction with custom entities, please see the <a href="../../02-guides/howto-custom-entity/">guide</a> for examples.</p>
        <p>You can also use custom shaders to override the behavior of built-in materials. Technically this is as easy as replacing the <code>shaderId: Option[ShaderId]</code> field on the material with the id of your own shader, but you will need to look into the source code to determine data that material provides to the shader.</p>
        
        <h2 id="providing-data-to-your-shaders" class="section"><a class="anchor-link left" href="#providing-data-to-your-shaders"><i class="icofont-laika link">&#xef71;</i></a>Providing data to your shaders</h2>
        <p>Shaders without any data can still be useful if you have a known effect, and not sending data is less costly than sending it! However, sometimes you need to tell your shader about what you need it to do, and for that we use <code>UniformBlock</code>s (know as UBO&#39;s technically, Uniform Buffer Objects).</p>
        <p>In the <a href="../../02-guides/howto-custom-entity/">guide</a>, we create a custom entity that fills it&#39;s self with a solid color:</p>
        <pre><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">MyColoredEntity</span><span>(</span><span class="identifier">position</span><span>: </span><span class="type-name">Point</span><span>, </span><span class="identifier">depth</span><span>: </span><span class="type-name">Depth</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">EntityNode</span><span>[</span><span class="type-name">MyColoredEntity</span><span>]:
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">size</span><span>: </span><span class="type-name">Size</span><span>        = </span><span class="type-name">Size</span><span>(</span><span class="number-literal">32</span><span>, </span><span class="number-literal">32</span><span>)
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">flip</span><span>: </span><span class="type-name">Flip</span><span>        = </span><span class="type-name">Flip</span><span>.</span><span class="keyword">default</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">ref</span><span>: </span><span class="type-name">Point</span><span>        = </span><span class="type-name">Point</span><span>.</span><span class="identifier">zero</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">rotation</span><span>: </span><span class="type-name">Radians</span><span> = </span><span class="type-name">Radians</span><span>.</span><span class="identifier">zero</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">scale</span><span>: </span><span class="type-name">Vector2</span><span>    = </span><span class="type-name">Vector2</span><span>.</span><span class="identifier">one</span><span>

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">eventHandler</span><span>: ((</span><span class="type-name">MyColoredEntity</span><span>, </span><span class="type-name">GlobalEvent</span><span>)) =&gt; </span><span class="type-name">Option</span><span>[</span><span class="type-name">GlobalEvent</span><span>] = </span><span class="identifier">_</span><span> =&gt; </span><span class="type-name">None</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">eventHandlerEnabled</span><span>: </span><span class="type-name">Boolean</span><span> = </span><span class="boolean-literal">false</span><span>

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">withDepth</span><span>(</span><span class="identifier">newDepth</span><span>: </span><span class="type-name">Depth</span><span>): </span><span class="type-name">MyColoredEntity</span><span> =
    </span><span class="keyword">this</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">depth</span><span> = </span><span class="identifier">newDepth</span><span>)

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">toShaderData</span><span>: </span><span class="type-name">ShaderData</span><span> =
    </span><span class="type-name">ShaderData</span><span>(</span><span class="type-name">MyColoredEntity</span><span>.</span><span class="identifier">shader</span><span>.</span><span class="identifier">id</span><span>)

</span><span class="keyword">object</span><span> </span><span class="type-name">MyColoredEntity</span><span>:
  </span><span class="keyword">val</span><span> </span><span class="identifier">shader</span><span>: </span><span class="type-name">EntityShader</span><span> =
    </span><span class="type-name">EntityShader</span><span>
      .</span><span class="type-name">Source</span><span>(</span><span class="type-name">ShaderId</span><span>(</span><span class="string-literal">&quot;my-colored-shader&quot;</span><span>))
      .</span><span class="identifier">withFragmentProgram</span><span>(
        </span><span class="string-literal">&quot;&quot;&quot;
        |void fragment() {
        |  COLOR = vec4(0.0, 1.0, 0.0, 1.0);
        |}
        |&quot;&quot;&quot;</span><span>.</span><span class="identifier">stripMargin</span><span>
      )</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run3&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        <p>If we wanted to supply the colour, we need to modify our code as follows:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">indigo</span><span>.</span><span class="type-name">ShaderPrimitive</span><span>.*

</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">MyColoredEntity</span><span>(</span><span class="identifier">position</span><span>: </span><span class="type-name">Point</span><span>, </span><span class="identifier">depth</span><span>: </span><span class="type-name">Depth</span><span>, </span><span class="identifier">color</span><span>: </span><span class="type-name">RGBA</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">EntityNode</span><span>[</span><span class="type-name">MyColoredEntity</span><span>]:
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">size</span><span>: </span><span class="type-name">Size</span><span>        = </span><span class="type-name">Size</span><span>(</span><span class="number-literal">32</span><span>, </span><span class="number-literal">32</span><span>)
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">flip</span><span>: </span><span class="type-name">Flip</span><span>        = </span><span class="type-name">Flip</span><span>.</span><span class="keyword">default</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">ref</span><span>: </span><span class="type-name">Point</span><span>        = </span><span class="type-name">Point</span><span>.</span><span class="identifier">zero</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">rotation</span><span>: </span><span class="type-name">Radians</span><span> = </span><span class="type-name">Radians</span><span>.</span><span class="identifier">zero</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">scale</span><span>: </span><span class="type-name">Vector2</span><span>    = </span><span class="type-name">Vector2</span><span>.</span><span class="identifier">one</span><span>

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">eventHandler</span><span>: ((</span><span class="type-name">MyColoredEntity</span><span>, </span><span class="type-name">GlobalEvent</span><span>)) =&gt; </span><span class="type-name">Option</span><span>[</span><span class="type-name">GlobalEvent</span><span>] = </span><span class="identifier">_</span><span> =&gt; </span><span class="type-name">None</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">eventHandlerEnabled</span><span>: </span><span class="type-name">Boolean</span><span> = </span><span class="boolean-literal">false</span><span>

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">withDepth</span><span>(</span><span class="identifier">newDepth</span><span>: </span><span class="type-name">Depth</span><span>): </span><span class="type-name">MyColoredEntity</span><span> =
    </span><span class="keyword">this</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">depth</span><span> = </span><span class="identifier">newDepth</span><span>)

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">toShaderData</span><span>: </span><span class="type-name">ShaderData</span><span> =
    </span><span class="type-name">ShaderData</span><span>(
      </span><span class="type-name">MyColoredEntity</span><span>.</span><span class="identifier">shader</span><span>.</span><span class="identifier">id</span><span>,
      </span><span class="type-name">UniformBlock</span><span>(
        </span><span class="type-name">UniformBlockName</span><span>(</span><span class="string-literal">&quot;MyCustomData&quot;</span><span>),
        </span><span class="type-name">Batch</span><span>(</span><span class="type-name">Uniform</span><span>(</span><span class="string-literal">&quot;MY_COLOR&quot;</span><span>) -&gt; </span><span class="identifier">vec4</span><span>(</span><span class="identifier">color</span><span>.</span><span class="identifier">r</span><span>, </span><span class="identifier">color</span><span>.</span><span class="identifier">g</span><span>, </span><span class="identifier">color</span><span>.</span><span class="identifier">b</span><span>, </span><span class="identifier">color</span><span>.</span><span class="identifier">a</span><span>))
      )
    )

</span><span class="keyword">object</span><span> </span><span class="type-name">MyColoredEntity</span><span>:
  </span><span class="keyword">val</span><span> </span><span class="identifier">shader</span><span>: </span><span class="type-name">EntityShader</span><span> =
    </span><span class="type-name">EntityShader</span><span>
      .</span><span class="type-name">Source</span><span>(</span><span class="type-name">ShaderId</span><span>(</span><span class="string-literal">&quot;my-colored-shader&quot;</span><span>))
      .</span><span class="identifier">withFragmentProgram</span><span>(
        </span><span class="string-literal">&quot;&quot;&quot;
        |layout (std140) uniform MyCustomData {
        |  vec4 MY_COLOR;
        |};
        |
        |void fragment() {
        |  COLOR = MY_COLOR;
        |}
        |&quot;&quot;&quot;</span><span>.</span><span class="identifier">stripMargin</span><span>
      )</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run4&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        <p>The <code>toShaderData</code> function now includes a uniform block that declares (in this case) a single variable called &quot;MY_COLOR&quot; of type <code>vec4</code>.</p>
        <blockquote>Aside, the variable names are not checked! It&#39;s the order that matters, but keep the names the same for your own sanity...</blockquote>
        <p>We then declare a uniform block (a special kind of struct) in the shader code, and then we can use the variable in your fragment function.</p>
        <p>Please note that variables sent over as uniform blocks are subject to data packing rules! See below!</p>
        
        <h2 id="uniformblock-ubo-data-packing-rules" class="section"><a class="anchor-link left" href="#uniformblock-ubo-data-packing-rules"><i class="icofont-laika link">&#xef71;</i></a><code>UniformBlock</code> / UBO Data Packing Rules</h2>
        <p>Take heed! These rules have saved me many times and originally came from here: <a href="https://youtu.be/bdIZ2ZloXEA?t=113"><a href="https://youtu.be/bdIZ2ZloXEA?t=113">https://youtu.be/bdIZ2ZloXEA?t=113</a></a></p>
        <pre><code>&quot;UBO - Uniform Buffer Object&quot;

Uses a struct as a way to defined the data in the buffer.
Struct data based on STD140 layout requires data to exist in 16 byte chunks.

Float, Int and Bools are treated as 4 Bytes of Data.

Arrays, no matter the type, each element is 16 Bytes.

vec2, Contains 2 floats so 4*2 bytes of data (8 Bytes)
vec4, Contains 4 floats so 4*4 bytes of data (16 Bytes)
vec3, Must be treated as 16 bytes of data (i.e. a vec4), last 4 bytes are buffer space

mat3, Contains 3 sets of Vec3 BUT each vec3 is treated as vec4, 3*16 Bytes of data
mat4, Contains 4 sets of Vec4, so 4 * 16 Bytes

For EXAMPLE
Float - Float - Vec3 - Float

FF00 VVVV F000

You also can&#39;t straddle byte boundries. So if you&#39;re trying to pack this: Float-Vec2
This is valid: F0VV
But this isn&#39;t: FVV0</code></pre>
        <p>&lt;script type=&quot;text/javascript&quot; src=&quot;shaders-overview.md.js&quot; defer&gt;&lt;/script&gt;
        &lt;script type=&quot;text/javascript&quot; src=&quot;mdoc.js&quot; defer&gt;&lt;/script&gt;</p>

        
<hr class="footer-rule"/>
<footer>
  Site generated by <a href="https://typelevel.org/Laika/">Laika</a> with the Helium theme.
</footer>


      </main>

    </div>

  </body>

</html>