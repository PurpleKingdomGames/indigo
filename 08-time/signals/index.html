<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Signals & Signal Functions</title>
  
  
  <meta name="description" content="A 2D Pixel Art FP game engine for Scala."/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/svg+xml" href="../../img/indigo_logo_solid.svg"/>
  
  <link rel="icon" sizes="64x64" type="image/svg+xml" href="../../img/indigo_logo_solid.svg"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../../css/custom.css" />
  <script src="../../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="../../"><img src="../../img/indigo_logo_solid_text.svg" alt="Homepage" title="Indigo" width="150" height="50"></a>

  <div class="row links">
    
    <a class="button-link" href="https://discord.gg/b5CD47g">Discord</a>
    
    <a class="button-link" href="/api">API</a>
    
    <a class="button-link" href="https://github.com/PurpleKingdomGames/indigo">Github</a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="button-link" href="https://discord.gg/b5CD47g">Discord</a>
    
    <a class="button-link" href="/api">API</a>
    
    <a class="button-link" href="https://github.com/PurpleKingdomGames/indigo">Github</a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../table-of-content/">Contents</a></li>
    <li class="level1 nav-header">Setup &amp; Configuration</li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/examples/">Examples, Demos, and References</a></li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/extensions-and-libs/">Extensions, Libraries, and Related Projects</a></li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/hello-indigo/">Hello, Indigo!</a></li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/project-templates/">Mill &amp; SBT Templates</a></li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/quickstart/">Quick start</a></li>
    <li class="level1 nav-header">Guides</li>
    <li class="level2 nav-leaf"><a href="../../02-guides/howto-custom-entity/">How to make a custom entity</a></li>
    <li class="level2 nav-leaf"><a href="../../02-guides/howto-fire-shader/">How to write a fire shader</a></li>
    <li class="level2 nav-leaf"><a href="../../02-guides/howto-hello-indigo-tyrian/">How to make a responsive UI using Tyrian</a></li>
    <li class="level2 nav-leaf"><a href="../../02-guides/howto-indigo-game/">Converting <code>IndigoSandbox</code> to <code>IndigoGame</code></a></li>
    <li class="level1 nav-header">Gameloop</li>
    <li class="level2 nav-leaf"><a href="../../03-gameloop/events/">Events</a></li>
    <li class="level2 nav-leaf"><a href="../../03-gameloop/frame-context/">Frame context</a></li>
    <li class="level2 nav-leaf"><a href="../../03-gameloop/outcome/">Outcome Type</a></li>
    <li class="level1 nav-header">Organisation</li>
    <li class="level2 nav-leaf"><a href="../../04-organisation/boot-and-start-up/">Boot &amp; Start Up</a></li>
    <li class="level2 nav-leaf"><a href="../../04-organisation/game-entry-points/">Game Entry Points</a></li>
    <li class="level2 nav-leaf"><a href="../../04-organisation/scene-management/">What are Scenes?</a></li>
    <li class="level2 nav-leaf"><a href="../../04-organisation/subsystems/">What SubSystems are</a></li>
    <li class="level1 nav-header">Platform &amp; IO</li>
    <li class="level2 nav-leaf"><a href="../../05-platform/assets/">Assets &amp; Asset Loading</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/configuration/">Game Configuration</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/cross-platform-publishing/">Cross Platform Publishing</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/importers/">File Importers</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/input-handling/">Input Handling</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/loading-and-saving-data/">Loading &amp; Saving Data</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/logging/">Logging</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/networking/">Networking</a></li>
    <li class="level1 nav-header">Presentation</li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/animation/">Animation</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/audio/">Audio</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/boundaries/">Boundaries</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/cameras/">Cameras</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/clones-and-mutants/">Clones &amp; Mutants</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/depth/">Depth</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/layers/">Layers</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/lighting/">Lighting</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/materials/">Materials</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/primitives/">Primitives &amp; Building Blocks</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/scene-update-fragment/">SceneUpdateFragment</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/shapes/">Shapes</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/text-and-fonts/">Text &amp; Fonts</a></li>
    <li class="level1 nav-header">Shaders</li>
    <li class="level2 nav-leaf"><a href="../../07-shaders/blending/">Blending</a></li>
    <li class="level2 nav-leaf"><a href="../../07-shaders/constants/">Shader Constants, Variables, and Outputs</a></li>
    <li class="level2 nav-leaf"><a href="../../07-shaders/premultiplied-alpha/">Premultiplied Alpha</a></li>
    <li class="level2 nav-leaf"><a href="../../07-shaders/shaders-overview/">Shaders Overview</a></li>
    <li class="level1 nav-header">Time</li>
    <li class="level2 nav-leaf"><a href="../gametime/">GameTime</a></li>
    <li class="level2 active nav-leaf"><a href="#">Signals &amp; Signal Functions</a></li>
    <li class="level2 nav-leaf"><a href="../time-varying-values/">Time Varying Values</a></li>
    <li class="level1 nav-header">UI Components</li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/button/">Buttons</a></li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/hit-area/">Hit Areas</a></li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/input-field/">Input Fields</a></li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/radio-button/">Radio Buttons</a></li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/ui-components/">UI Components</a></li>
    <li class="level1 nav-header">Misc</li>
    <li class="level2 nav-leaf"><a href="../../10-information/alternatives/">Alternatives to Indigo</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/antipatterns/">Anti-Patterns</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/glossary/">Glossary</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/key-concepts/">Key Concepts</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/model-viewmodel-view/">Model, ViewModel, &amp; View</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/motivation-and-constraints/">Motivation &amp; Constraints</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/pathfinding/">Path finding</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/performance/">Performance</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/prior-art/">Prior Art</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/rendering-technology/">Rendering Technology</a></li>
    <li class="level1 nav-header">Physics</li>
    <li class="level2 nav-leaf"><a href="../../11-physics/physics-overview/">Physics Overview</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Signals &amp; Signal Functions</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#motivation">Motivation</a></li>
    <li class="level1 nav-leaf"><a href="#background">Background</a></li>
    <li class="level1 nav-leaf"><a href="#signal-a"><code>Signal[A]</code></a></li>
    <li class="level1 nav-node"><a href="#signals-animation">Signals &amp; Animation</a></li>
    <li class="level2 nav-leaf"><a href="#just-move-it-along-the-x-axis">Just move it along the x-axis</a></li>
    <li class="level2 nav-leaf"><a href="#can-we-introduce-frame-independence">Can we introduce frame independence?</a></li>
    <li class="level2 nav-leaf"><a href="#using-a-higher-precision">Using a higher precision</a></li>
    <li class="level2 nav-leaf"><a href="#stateless-procedural-animations">Stateless procedural animations</a></li>
    <li class="level2 nav-leaf"><a href="#lets-do-the-time-warp">Lets do the time warp</a></li>
    <li class="level1 nav-leaf"><a href="#testing">Testing</a></li>
    <li class="level1 nav-leaf"><a href="#signal-construction">Signal construction</a></li>
    <li class="level1 nav-leaf"><a href="#signalfunctions"><code>SignalFunction</code>s</a></li>
    <li class="level1 nav-leaf"><a href="#signalreader">SignalReader</a></li>
    <li class="level1 nav-leaf"><a href="#signalstate">SignalState</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="signals-signal-functions" class="title">Signals &amp; Signal Functions</h1>
        
        <h2 id="motivation" class="section"><a class="anchor-link left" href="#motivation"><i class="icofont-laika link">&#xef71;</i></a>Motivation</h2>
        <p>We want pure, referentially transparent, testable, procedural animations.</p>
        <blockquote>Definition: A procedural animation is an animation produced by code, rather than created by hand in, say, an animation tool and played back.</blockquote>
        
        <h2 id="background" class="section"><a class="anchor-link left" href="#background"><i class="icofont-laika link">&#xef71;</i></a>Background</h2>
        <p>The goal of Indigo is to make programming games (as opposed to making them...), easier to reason about and easier to test by leveraging the good ideas that come with functional programming.</p>
        <p>One of those good ideas that Indigo borrows is the notion of Signals and Signal Functions. Signals for animation were first proposed in the Functional Reactive ANimation (FRAN) system, but are most readily seen in <a href="https://github.com/ivanperez-keera/Yampa">Yampa</a>.</p>
        <p>Indigo makes use of Signals too, though not to the same extent as Yampa. The main difference is that Signals in Indigo are stateless and therefore somewhat limited. Nonetheless, Signals in Indigo are still interesting and useful, and provide the backbone of the Automata subsystem.</p>
        
        <h2 id="signal-a" class="section"><a class="anchor-link left" href="#signal-a"><i class="icofont-laika link">&#xef71;</i></a><code>Signal[A]</code></h2>
        <p>At it&#39;s core, a signal is a very simple thing. Consider this hypothetical abstract function signature:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">f</span><span>: </span><span class="type-name">A</span><span> =&gt; </span><span class="type-name">B</span></code></pre>
        <p>What this function signature says is that when provided some value of type <code>A</code>, it <em>will</em> produce some value of type <code>B</code>. In concrete terms, if we fix the types to known primitives, the follow example says that when given a <code>String</code>, it will return an <code>Int</code>:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">f</span><span>: </span><span class="type-name">String</span><span> =&gt; </span><span class="type-name">Int</span></code></pre>
        <p>A <code>Signal[A]</code> is similar and looks like this:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">indigo</span><span>.*

</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Signal</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">f</span><span>: </span><span class="type-name">Seconds</span><span> =&gt; </span><span class="type-name">A</span><span>)</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run0&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        <p>In other words, a <code>Signal</code> of <code>A</code> is nothing more than a function that when given the current running time in <code>Seconds</code>, <em>will</em> produce some value of type <code>A</code>.</p>
        
        <h2 id="signals-animation" class="section"><a class="anchor-link left" href="#signals-animation"><i class="icofont-laika link">&#xef71;</i></a>Signals &amp; Animation</h2>
        <p>Lets consider a very very simple animation: Moving a graphic from coordinates (0, 0) to (10, 0), i.e. 10 pixels along the x-axis.</p>
        <p>If you animated this by hand, you&#39;d have a series of animation frames rendered to an image that you playback one after the other, which is fine but rather limited.</p>
        <p>So instead, lets think about how we might produce this animation in code.</p>
        
        <h3 id="just-move-it-along-the-x-axis" class="section"><a class="anchor-link left" href="#just-move-it-along-the-x-axis"><i class="icofont-laika link">&#xef71;</i></a>Just move it along the x-axis</h3>
        <p>We could just say:</p>
        <ol class="arabic">
          <li>On frame tick</li>
          <li>Increment the x of the object by 1</li>
          <li>if the x &gt; 10, make it 10</li>
        </ol>
        <p>That will work, but the trouble is that the animation will be jerky*. Since the amount of time between frame updates varies and you are moving the object by a fixed amount regardless of time, it will speed up and slow down rapidly and look jittery.</p>
        <blockquote>*It <em>would</em> be jerky if you had time to see it. The animation would be complete in a fraction of a second!</blockquote>
        
        <h3 id="can-we-introduce-frame-independence" class="section"><a class="anchor-link left" href="#can-we-introduce-frame-independence"><i class="icofont-laika link">&#xef71;</i></a>Can we introduce frame independence?</h3>
        <p>To fix the jitter above, all we have to do is factor in time, as follows:</p>
        <ol class="arabic">
          <li>On frame tick, and grab the time delta in seconds</li>
          <li>Increment the x of the object by 1 * the time delta</li>
          <li>if the x &gt; 10, make it 10</li>
        </ol>
        <p>Here the time delta is the amount of time that has elapsed since the last frame. What we&#39;re saying is that &quot;1&quot; is the number of units to move per second, and by multiplying it by the time delta we will move at a rate of 1 units per second across the screen.</p>
        <p>That&#39;s a much slower rate of progress than method #1 but if we want it to go faster we can just increase the units per second. The point is that progress across the screen is now smooth since time is taken into consideration and the amount of movement is proportional to the time elapsed. This is known as frame independence.</p>
        <p><strong><em>...except it doesn&#39;t work.</em></strong> Or rather, in Indigo it is subject to a new failure mode: Integer rounding.</p>
        <p>Since it is designed for pixel art, Indigo works in whole pixels by default which are represented as integers. Consider the following:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">positionX</span><span>: </span><span class="type-name">Int</span><span> = </span><span class="number-literal">0</span><span> </span><span class="comment">// We start at 0 but this works at any value
</span><span class="keyword">val</span><span> </span><span class="identifier">unitsPerSsecond</span><span>: </span><span class="type-name">Int</span><span> = </span><span class="number-literal">1</span><span> </span><span class="comment">// move at 1 pixel per second
</span><span class="keyword">val</span><span> </span><span class="identifier">timeDelta</span><span>: </span><span class="type-name">Double</span><span> = </span><span class="number-literal">0.01666666667</span><span> </span><span class="comment">// Average time delta for 60 frames per second
</span><span>
(</span><span class="identifier">positionX</span><span> + </span><span class="number-literal">1</span><span> * </span><span class="identifier">timeDelta</span><span>).</span><span class="identifier">toInt</span><span> </span><span class="comment">// toInt for pixels, which are integers
// res2: Int = 0 // Oops!</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run1&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        <p>We made no progress! In fact we will never make any progress because it doesn&#39;t matter how many times you add zero to anything the answer is always the original value! Gah!</p>
        
        <h3 id="using-a-higher-precision" class="section"><a class="anchor-link left" href="#using-a-higher-precision"><i class="icofont-laika link">&#xef71;</i></a>Using a higher precision</h3>
        <p>Frame independence is an improvement, but we need something else.</p>
        <p>One thing we can do is to hold the position information in a higher precision type like a <code>Double</code> or a <code>Float</code>. We can&#39;t keep that information in the view though, so to hold that bit of state we need to purposefully put it in the model or view model somewhere.</p>
        <p>Assuming we do hold that state, we have now separated the model from the presentation (slightly). In the model we work in &quot;world space&quot; (in <code>Double</code>s) and convert into screen space to draw (by converting the <code>Double</code> value to <code>Int</code> at that last moment).</p>
        <blockquote>In this example, converting from world space to screen space is simply casting a Double to an Int, but it&#39;s common for presentation and model representations to be very different.</blockquote>
        <p>This is the right solution for any animation where taking the trouble to model and store the data is useful. A character walking across the screen that needs to change direction in response to the world for example.</p>
        <p>But sometimes that&#39;s just noise. For example, imagine a character picking up a gold coin and a little dollar sign floating up over their heads momentarily. It&#39;s an important visual aid, but modeling and tracking the state for that little dollar sign&#39;s motion is neither interesting or useful in the wider context of the game.</p>
        <p>Is there another way?</p>
        
        <h3 id="stateless-procedural-animations" class="section"><a class="anchor-link left" href="#stateless-procedural-animations"><i class="icofont-laika link">&#xef71;</i></a>Stateless procedural animations</h3>
        <p>Lets start over. All we want do is smoothly move along the x axis by 10 pixels over a certain duration, say 10 seconds.</p>
        <p>Which means that how far through our animation we are, is actually a function of time, i.e. at time 0 seconds we&#39;re at the beginning of our animation, at 5 seconds we&#39;re in the middle, and at 10 seconds we&#39;ve reach the end. That could be frames in a animation, position along a trajectory, time through a simulation - anything.</p>
        <p>To make this work we need some initial conditions and a function that given those conditions with the current time produces the correct animation output.</p>
        <p>Lets try it in vanilla Scala first.</p>
        <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">calculatePosition</span><span>(
    </span><span class="identifier">startPositionX</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="comment">// initial condition
</span><span>    </span><span class="identifier">runningTime</span><span>: </span><span class="type-name">Double</span><span> </span><span class="comment">// how long the animation has been running, a relative value
</span><span>  ): </span><span class="type-name">Int</span><span> = { </span><span class="comment">// Our output x position as a whole pixel
</span><span>  </span><span class="keyword">val</span><span> </span><span class="identifier">clampedTime</span><span>: </span><span class="type-name">Double</span><span> = </span><span class="keyword">if</span><span>(</span><span class="identifier">runningTime</span><span> &gt; </span><span class="number-literal">10d</span><span>) </span><span class="number-literal">10d</span><span> </span><span class="keyword">else</span><span> </span><span class="identifier">runningTime</span><span>
  </span><span class="keyword">val</span><span> </span><span class="identifier">distanceToMove</span><span>: </span><span class="type-name">Double</span><span> = </span><span class="number-literal">10</span><span>
  </span><span class="keyword">val</span><span> </span><span class="identifier">pixelsPerSecond</span><span> = </span><span class="number-literal">1</span><span> / </span><span class="identifier">distanceToMove</span><span>

  </span><span class="identifier">startPositionX</span><span> + (</span><span class="identifier">distanceToMove</span><span> * </span><span class="identifier">pixelsPerSecond</span><span> * </span><span class="identifier">clampedTime</span><span>).</span><span class="identifier">toInt</span><span>
}

</span><span class="identifier">calculatePosition</span><span>(</span><span class="number-literal">0</span><span>, </span><span class="number-literal">0</span><span>)
</span><span class="comment">// res2: Int = 0
</span><span>
</span><span class="identifier">calculatePosition</span><span>(</span><span class="number-literal">0</span><span>, </span><span class="number-literal">2.5</span><span>)
</span><span class="comment">// res2: Int = 2
</span><span>
</span><span class="identifier">calculatePosition</span><span>(</span><span class="number-literal">0</span><span>, </span><span class="number-literal">5</span><span>)
</span><span class="comment">// res2: Int = 5
</span><span>
</span><span class="identifier">calculatePosition</span><span>(</span><span class="number-literal">0</span><span>, </span><span class="number-literal">7.5</span><span>)
</span><span class="comment">// res2: Int = 7
</span><span>
</span><span class="identifier">calculatePosition</span><span>(</span><span class="number-literal">0</span><span>, </span><span class="number-literal">10</span><span>)
</span><span class="comment">// res2: Int = 10
</span><span>
</span><span class="identifier">calculatePosition</span><span>(</span><span class="number-literal">0</span><span>, </span><span class="number-literal">15</span><span>)
</span><span class="comment">// res2: Int = 10</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run2&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        <p>So that&#39;s an animation described in terms of a function of time ...which means we must be able to encode that as a <code>Signal</code>, so lets try the <code>Signal</code> version:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">indigo</span><span>.*

</span><span class="keyword">def</span><span> </span><span class="declaration-name">calculatePosition</span><span>(</span><span class="identifier">startPositionX</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">Signal</span><span>[</span><span class="type-name">Int</span><span>] =
  </span><span class="type-name">Signal</span><span> { </span><span class="identifier">t</span><span> =&gt;
    </span><span class="keyword">val</span><span> </span><span class="identifier">clampedTime</span><span>: </span><span class="type-name">Double</span><span> = </span><span class="keyword">if</span><span>(</span><span class="identifier">t</span><span>.</span><span class="identifier">toDouble</span><span> &gt; </span><span class="number-literal">10d</span><span>) </span><span class="number-literal">10d</span><span> </span><span class="keyword">else</span><span> </span><span class="identifier">t</span><span>.</span><span class="identifier">toDouble</span><span>
    </span><span class="keyword">val</span><span> </span><span class="identifier">distanceToMove</span><span>: </span><span class="type-name">Double</span><span> = </span><span class="number-literal">10</span><span>
    </span><span class="keyword">val</span><span> </span><span class="identifier">pixelsPerSecond</span><span> = </span><span class="number-literal">1</span><span> / </span><span class="identifier">distanceToMove</span><span>

    </span><span class="identifier">startPositionX</span><span> + (</span><span class="identifier">distanceToMove</span><span> * </span><span class="identifier">pixelsPerSecond</span><span> * </span><span class="identifier">clampedTime</span><span>).</span><span class="identifier">toInt</span><span>
  }

</span><span class="keyword">val</span><span> </span><span class="identifier">signal</span><span> = </span><span class="identifier">calculatePosition</span><span>(</span><span class="number-literal">0</span><span>)

</span><span class="identifier">signal</span><span>.</span><span class="identifier">at</span><span>(</span><span class="type-name">Seconds</span><span>(</span><span class="number-literal">0</span><span>))
</span><span class="comment">// res2: Int = 0
</span><span>
</span><span class="identifier">signal</span><span>.</span><span class="identifier">at</span><span>(</span><span class="type-name">Seconds</span><span>(</span><span class="number-literal">2.5</span><span>))
</span><span class="comment">// res2: Int = 2
</span><span>
</span><span class="identifier">signal</span><span>.</span><span class="identifier">at</span><span>(</span><span class="type-name">Seconds</span><span>(</span><span class="number-literal">5</span><span>))
</span><span class="comment">// res2: Int = 5
</span><span>
</span><span class="identifier">signal</span><span>.</span><span class="identifier">at</span><span>(</span><span class="type-name">Seconds</span><span>(</span><span class="number-literal">7.5</span><span>))
</span><span class="comment">// res2: Int = 7
</span><span>
</span><span class="identifier">signal</span><span>.</span><span class="identifier">at</span><span>(</span><span class="type-name">Seconds</span><span>(</span><span class="number-literal">10</span><span>))
</span><span class="comment">// res2: Int = 10
</span><span>
</span><span class="identifier">signal</span><span>.</span><span class="identifier">at</span><span>(</span><span class="type-name">Seconds</span><span>(</span><span class="number-literal">15</span><span>))
</span><span class="comment">// res2: Int = 10</span></code></pre>
        <p>Very similar! The result is that we have now captured the animated value as a frame independent function of time that requires no ongoing state management.</p>
        
        <h3 id="lets-do-the-time-warp" class="section"><a class="anchor-link left" href="#lets-do-the-time-warp"><i class="icofont-laika link">&#xef71;</i></a>Lets do the time warp</h3>
        <p>To get the value out of a signal, you just need to tell give it a time in seconds, e.g. <code>signal.at(Seconds(5))</code>. Where things get interesting is that there is no requirement to give it the &quot;next&quot; time. You can give it any time you like.</p>
        <p>Want to play the animation backwards?
        <code>signal.at(total time - running time)</code></p>
        <p>Want to play the animation at half speed?
        <code>signal.at(running time * 0.5)</code></p>
        <p>Want to jump to random &quot;frames&quot; in the animation?
        <code>signal.at(Seconds(dice.roll(10)))</code></p>
        <p>Want to squidge (technical term) backwards and forwards through the animation?
        <code>Signal.SmoothPulse.flatMap(signal.at(total time * _))</code></p>
        
        <h2 id="testing" class="section"><a class="anchor-link left" href="#testing"><i class="icofont-laika link">&#xef71;</i></a>Testing</h2>
        <p>Since the animation is now captured as a pure function based on time, you can now test your animation!</p>
        <p>You can replicate something simple in a unit test, not unlike the examples above, or you can use property based testing as demonstrated in the <a href="https://github.com/PurpleKingdomGames/indigo-examples/blob/master/examples/fireworks/src/test/scala/indigoexamples/model/TrailParticleSpecification.scala">fireworks example</a>.</p>
        
        <h2 id="signal-construction" class="section"><a class="anchor-link left" href="#signal-construction"><i class="icofont-laika link">&#xef71;</i></a>Signal construction</h2>
        <p>Making signals can get complicated, particularly if you try to wrap up all of the business logic in a single <code>Signal</code> definition as we have done above.</p>
        <p>Signals are Monads, meaning that many of the usual functions like <code>map</code>, <code>ap</code>, and <code>flatMap</code> that you&#39;d expect to see are available to use. For example, here is a signal being constructed in a for comprehension:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">indigo</span><span>.*

</span><span class="keyword">val</span><span> </span><span class="identifier">signal</span><span> =
  </span><span class="keyword">for</span><span> {
    </span><span class="identifier">a</span><span> &lt;- </span><span class="type-name">Signal</span><span>.</span><span class="identifier">fixed</span><span>(</span><span class="number-literal">10</span><span>)
    </span><span class="identifier">b</span><span> &lt;- </span><span class="type-name">Signal</span><span>.</span><span class="identifier">fixed</span><span>(</span><span class="number-literal">20</span><span>)
    </span><span class="identifier">c</span><span> &lt;- </span><span class="type-name">Signal</span><span>.</span><span class="identifier">fixed</span><span>(</span><span class="number-literal">30</span><span>)
  } </span><span class="keyword">yield</span><span> </span><span class="identifier">a</span><span> + </span><span class="identifier">b</span><span> + </span><span class="identifier">c</span><span>

</span><span class="identifier">signal</span><span>.</span><span class="identifier">at</span><span>(</span><span class="type-name">Seconds</span><span>.</span><span class="identifier">zero</span><span>) </span><span class="comment">// 60</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run4&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        <p>This helps a lot with building signal values, but another useful construct is the <code>SignalFunction</code>.</p>
        
        <h2 id="signalfunctions" class="section"><a class="anchor-link left" href="#signalfunctions"><i class="icofont-laika link">&#xef71;</i></a><code>SignalFunction</code>s</h2>
        <p><code>SignalFunction</code>s allow you to compose signals and functions that operator on signals together.</p>
        <p>Signal functions are combinators, and a combinator is a function that takes a function as an argument and returns another function, like this:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="comment">// A function that take as an argument a function that takes an
// Int and returns a String, and then returns a function that
// takes and Int and returns a Boolean
</span><span class="keyword">val</span><span> </span><span class="identifier">f</span><span>: (</span><span class="type-name">Int</span><span> =&gt; </span><span class="type-name">String</span><span>) =&gt; (</span><span class="type-name">Int</span><span> =&gt; </span><span class="type-name">Boolean</span><span>)</span></code></pre>
        <p>A Signal function takes a <code>Signal[A]</code> and returns a <code>Signal[B]</code>. Recall that a <code>Signal[T]</code> is really just a function from <code>time</code> to <code>T</code>, thus:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">SignalFunction</span><span>(</span><span class="identifier">f</span><span>: </span><span class="type-name">Signal</span><span>[</span><span class="type-name">A</span><span>] =&gt; </span><span class="type-name">Signal</span><span>[</span><span class="type-name">B</span><span>])</span></code></pre>
        <p>is really a combinator:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="comment">// pseudo scala
</span><span class="type-name">SignalFunction</span><span>((</span><span class="identifier">time</span><span> =&gt; </span><span class="type-name">A</span><span>) =&gt; (</span><span class="identifier">time</span><span> =&gt; </span><span class="type-name">B</span><span>))</span></code></pre>
        <p>The constructor for a Signal function is actually <code>SignalFunction(f: A =&gt; B)</code>, as a pose to <code>SignalFunction(f: Signal[A] =&gt; Signal[B])</code>. this is much more convenient and better explains what you&#39;re actually doing with signal functions. Here&#39;s a simple example:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">indigo</span><span>.*

</span><span class="keyword">val</span><span> </span><span class="identifier">signal</span><span> = </span><span class="type-name">Signal</span><span>.</span><span class="identifier">fixed</span><span>(</span><span class="number-literal">10</span><span>) |&gt; </span><span class="type-name">SignalFunction</span><span>((</span><span class="identifier">i</span><span>: </span><span class="type-name">Int</span><span>) =&gt; </span><span class="string-literal">&quot;count: &quot;</span><span> + </span><span class="identifier">i</span><span>.</span><span class="identifier">toString</span><span>)

</span><span class="identifier">signal</span><span>.</span><span class="identifier">at</span><span>(</span><span class="type-name">Seconds</span><span>.</span><span class="identifier">zero</span><span>)
</span><span class="comment">// &quot;count: 10&quot;</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run5&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        <p>In this example we pipe a fixed value (ignores time) into a signal function which prints a string. So far, we could have achieved this by just using <code>map</code>:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">indigo</span><span>.*

</span><span class="keyword">val</span><span> </span><span class="identifier">signal</span><span> = </span><span class="type-name">Signal</span><span>.</span><span class="identifier">fixed</span><span>(</span><span class="number-literal">10</span><span>).</span><span class="identifier">map</span><span>(</span><span class="identifier">i</span><span> =&gt; </span><span class="string-literal">&quot;count: &quot;</span><span> + </span><span class="identifier">i</span><span>.</span><span class="identifier">toString</span><span>)

</span><span class="identifier">signal</span><span>.</span><span class="identifier">at</span><span>(</span><span class="type-name">Seconds</span><span>.</span><span class="identifier">zero</span><span>)
</span><span class="comment">// &quot;count: 10&quot;</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run6&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        <p>You don&#39;t <em>need</em> signal functions, but they are a nice way to describe combining and processing signals. Here is an more interesting example:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">indigo</span><span>.*

</span><span class="keyword">val</span><span> </span><span class="identifier">makeRange</span><span>: </span><span class="type-name">SignalFunction</span><span>[</span><span class="type-name">Boolean</span><span>, </span><span class="type-name">List</span><span>[</span><span class="type-name">Int</span><span>]] =
  </span><span class="type-name">SignalFunction</span><span> { </span><span class="identifier">p</span><span> =&gt;
    </span><span class="keyword">val</span><span> </span><span class="identifier">num</span><span> = </span><span class="keyword">if</span><span> (</span><span class="identifier">p</span><span>) </span><span class="number-literal">10</span><span> </span><span class="keyword">else</span><span> </span><span class="number-literal">5</span><span>
    (</span><span class="number-literal">1</span><span> </span><span class="identifier">to</span><span> </span><span class="identifier">num</span><span>).</span><span class="identifier">toList</span><span>
  }

</span><span class="keyword">val</span><span> </span><span class="identifier">chooseCatsOrDogs</span><span>: </span><span class="type-name">SignalFunction</span><span>[</span><span class="type-name">Boolean</span><span>, </span><span class="type-name">String</span><span>] =
  </span><span class="type-name">SignalFunction</span><span>(</span><span class="identifier">p</span><span> =&gt; </span><span class="keyword">if</span><span> (</span><span class="identifier">p</span><span>) </span><span class="string-literal">&quot;dog&quot;</span><span> </span><span class="keyword">else</span><span> </span><span class="string-literal">&quot;cat&quot;</span><span>)

</span><span class="keyword">val</span><span> </span><span class="identifier">howManyPets</span><span>: </span><span class="type-name">SignalFunction</span><span>[(</span><span class="type-name">List</span><span>[</span><span class="type-name">Int</span><span>], </span><span class="type-name">String</span><span>), </span><span class="type-name">List</span><span>[</span><span class="type-name">String</span><span>]] =
  </span><span class="type-name">SignalFunction</span><span> {
    </span><span class="keyword">case</span><span> (</span><span class="identifier">l</span><span>, </span><span class="identifier">str</span><span>) =&gt;
      </span><span class="identifier">l</span><span>.</span><span class="identifier">map</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">toString</span><span> + </span><span class="string-literal">&quot; &quot;</span><span> + </span><span class="identifier">str</span><span>)
  }

</span><span class="comment">// Pulse is a type of signal. Based on the time, it with produce
// an on/off boolean like:
//      ____    ____    ____
//  ___|   |___|   |___|   |___
</span><span class="keyword">val</span><span> </span><span class="identifier">signal</span><span> = </span><span class="type-name">Signal</span><span>.</span><span class="type-name">Pulse</span><span>(</span><span class="type-name">Seconds</span><span>(</span><span class="number-literal">1</span><span>))

</span><span class="comment">// &amp;&amp;&amp; / and - run in parallel and tuple the results
// &gt;&gt;&gt; / andThen - compose the functions together from left to right
</span><span class="keyword">val</span><span> </span><span class="identifier">signalFunction</span><span> = (</span><span class="identifier">makeRange</span><span> &amp;&amp;&amp; </span><span class="identifier">chooseCatsOrDogs</span><span>) &gt;&gt;&gt; </span><span class="identifier">howManyPets</span><span>
</span><span class="comment">// or
// val signalFunction = (makeRange and chooseCatsOrDogs) andThen howManyPets
</span><span>
(</span><span class="identifier">signal</span><span> |&gt; </span><span class="identifier">signalFunction</span><span>).</span><span class="identifier">at</span><span>(</span><span class="type-name">Seconds</span><span>.</span><span class="identifier">zero</span><span>)
</span><span class="comment">// List(&quot;1 dog&quot;, &quot;2 dog&quot;, &quot;3 dog&quot;, &quot;4 dog&quot;, &quot;5 dog&quot;, &quot;6 dog&quot;, &quot;7 dog&quot;, &quot;8 dog&quot;, &quot;9 dog&quot;, &quot;10 dog&quot;)
</span><span>
(</span><span class="identifier">signal</span><span> |&gt; </span><span class="identifier">signalFunction</span><span>).</span><span class="identifier">at</span><span>(</span><span class="type-name">Seconds</span><span>(</span><span class="number-literal">1</span><span>))
</span><span class="comment">// List(&quot;1 cat&quot;, &quot;2 cat&quot;, &quot;3 cat&quot;, &quot;4 cat&quot;, &quot;5 cat&quot;)</span></code></pre>
        <p>&lt;div id=&quot;mdoc-html-run7&quot; data-mdoc-js&gt;&lt;/div&gt;</p>
        
        <h2 id="signalreader" class="section"><a class="anchor-link left" href="#signalreader"><i class="icofont-laika link">&#xef71;</i></a>SignalReader</h2>
        <p><code>// TODO</code></p>
        
        <h2 id="signalstate" class="section"><a class="anchor-link left" href="#signalstate"><i class="icofont-laika link">&#xef71;</i></a>SignalState</h2>
        <p><code>// TODO</code>
        &lt;script type=&quot;text/javascript&quot; src=&quot;signals.md.js&quot; defer&gt;&lt;/script&gt;
        &lt;script type=&quot;text/javascript&quot; src=&quot;mdoc.js&quot; defer&gt;&lt;/script&gt;</p>

        
<hr class="footer-rule"/>
<footer>
  Site generated by <a href="https://typelevel.org/Laika/">Laika</a> with the Helium theme.
</footer>


      </main>

    </div>

  </body>

</html>