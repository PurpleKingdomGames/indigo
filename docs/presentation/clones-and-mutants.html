<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Clones &amp; Mutants · Indigo</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&gt; Available in the forthcoming Indigo 0.10.0 only. There were earlier versions of Clones but they were never documented properly and they&#x27;ve all been superseded."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Clones &amp; Mutants · Indigo"/><meta property="og:type" content="website"/><meta property="og:url" content="https://your-docusaurus-test-site.com/"/><meta property="og:description" content="&gt; Available in the forthcoming Indigo 0.10.0 only. There were earlier versions of Clones but they were never documented properly and they&#x27;ve all been superseded."/><meta property="og:image" content="https://your-docusaurus-test-site.com/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://your-docusaurus-test-site.com/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/indigo_logo_solid.svg"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://your-docusaurus-test-site.com/blog/atom.xml" title="Indigo Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://your-docusaurus-test-site.com/blog/feed.xml" title="Indigo Blog RSS Feed"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-169190516-1"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'UA-169190516-1');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/indigo_logo_solid_text.svg" alt="Indigo"/><h2 class="headerTitleWithLogo">Indigo</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="/docs/guides" target="_self">Guides</a></li><li class="siteNavGroupActive"><a href="/docs/development-status" target="_self">Docs</a></li><li class=""><a href="/api/" target="_self">APIs</a></li><li class=""><a href="/tools" target="_self">Tools</a></li><li class=""><a href="https://github.com/PurpleKingdomGames/indigo" target="_blank">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Presentation</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Indigo</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/development-status">Indigo&#x27;s Development Status</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/quickstart/setup-and-configuration">Setup &amp; Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/quickstart/examples">Examples</a></li><li class="navListItem"><a class="navItem" href="/docs/quickstart/project-templates">Mill &amp; SBT Game Templates</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Organising your game</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/organisation/boot-and-start-up">Boot &amp; Start Up</a></li><li class="navListItem"><a class="navItem" href="/docs/organisation/game-entry-points">Game Entry Points</a></li><li class="navListItem"><a class="navItem" href="/docs/organisation/scene-management">Scenes &amp; Scene Management</a></li><li class="navListItem"><a class="navItem" href="/docs/organisation/subsystems">SubSystems</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">The game loop</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/gameloop/events">Events</a></li><li class="navListItem"><a class="navItem" href="/docs/gameloop/frame-context">Frame context</a></li><li class="navListItem"><a class="navItem" href="/docs/gameloop/outcome">Outcome Type</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Presentation</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/presentation/animation">Animation</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/audio">Audio</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/boundaries">Boundaries</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/cameras">Cameras</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/presentation/clones-and-mutants">Clones &amp; Mutants</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/depth">Depth</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/layers">Layers</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/lighting">Lighting</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/materials">Materials</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/primitives">Primitives &amp; Building Blocks</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/scene-update-fragment">SceneUpdateFragment</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/shapes">Shapes</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/text-and-fonts">Text &amp; Fonts</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">UI Components</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/uicomponents/ui-components">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/uicomponents/button">Buttons</a></li><li class="navListItem"><a class="navItem" href="/docs/uicomponents/hit-area">Hit Area</a></li><li class="navListItem"><a class="navItem" href="/docs/uicomponents/input-field">Input Field</a></li><li class="navListItem"><a class="navItem" href="/docs/uicomponents/radio-button">Radio Button</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Shaders</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/shaders/shader-overview">Shaders Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/shaders/constants">Shader Constants, Variables, and Outputs</a></li><li class="navListItem"><a class="navItem" href="/docs/shaders/blending">Blending</a></li><li class="navListItem"><a class="navItem" href="/docs/shaders/premultiplied-alpha">Premultiplied Alpha</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Working with Time</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/time/signals">Signals &amp; Signal Functions</a></li><li class="navListItem"><a class="navItem" href="/docs/time/time-varying-values">Time Varying Values</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Platform &amp; Publishing</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/platform/assets">Assets &amp; Asset Loading</a></li><li class="navListItem"><a class="navItem" href="/docs/platform/cross-platform-publishing">Cross Platform Publishing</a></li><li class="navListItem"><a class="navItem" href="/docs/platform/importers">File Format Importers</a></li><li class="navListItem"><a class="navItem" href="/docs/platform/input-handling">User Input Handling</a></li><li class="navListItem"><a class="navItem" href="/docs/platform/loading-and-saving-data">Loading &amp; Saving Data</a></li><li class="navListItem"><a class="navItem" href="/docs/platform/logging">Logging</a></li><li class="navListItem"><a class="navItem" href="/docs/platform/networking">Networking</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Other information</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/information/alternatives">Alternatives to Indigo</a></li><li class="navListItem"><a class="navItem" href="/docs/information/glossary">Glossary</a></li><li class="navListItem"><a class="navItem" href="/docs/information/key-concepts">Key Concepts</a></li><li class="navListItem"><a class="navItem" href="/docs/information/model-viewmodel-view">Model, ViewModel, &amp; View</a></li><li class="navListItem"><a class="navItem" href="/docs/information/antipatterns">Anti-Patterns</a></li><li class="navListItem"><a class="navItem" href="/docs/information/motivation-and-constraints">Motivation &amp; Constraints</a></li><li class="navListItem"><a class="navItem" href="/docs/information/performance">Performance</a></li><li class="navListItem"><a class="navItem" href="/docs/information/prior-art">Prior Art</a></li><li class="navListItem"><a class="navItem" href="/docs/information/rendering-technology">Rendering Technology</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Clones &amp; Mutants</h1></header><article><div><span><blockquote>
<p>Available in the forthcoming Indigo 0.10.0 only. There were earlier versions of Clones but they were never documented properly and they've all been superseded.</p>
</blockquote>
<p>Sometimes you really need to draw a lot of things. Thousands and thousands of things.</p>
<p>If you try and do that with standard primitives you'll be disappointed to find that you quickly hit a ceiling somewhere in the hundreds. To be clear, hundreds of things is probably ample for most 2D games, but sometimes you need more.</p>
<p>The reason you'll cap out at perhaps 400 to 600 primitives is that each one carries an overhead through the rendering pipeline. Each one has to be processed, events collected, actions performed, animations updated, and finally rendered. This pipeline allows each element to be unique and easy to use.</p>
<p>If you want to go faster, what you need to do is trade off uniqueness and convenience for sheer quantity, and you do that by skipping some part of the rendering pipeline.</p>
<p>This is what clones and mutants do, the take an archetypal primitive, process it once, and then skip huge sections of the rendering pipeline for all the copies of that thing.</p>
<p>You lose some aspect of control, but you gain volume.</p>
<h2><a class="anchor" aria-hidden="true" id="clones-vs-mutants"></a><a href="#clones-vs-mutants" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Clones vs Mutants</h2>
<p>While clones are mutants are based on the same basic idea, they work very differently. Both allow you to increase the number of things you can render, but they make different trade offs.</p>
<ul>
<li><p><strong>Clones</strong> make many copies of the original utilising hardware instancing, but only allow you to modify a few basic pieces of transformation information per instance.*</p></li>
<li><p><strong>Mutants</strong> allow you to do whatever you want, but the catch is that all changes - even basic transformations like position - must be done within the shader.</p></li>
</ul>
<p>Clones are designed to reduce graphics card context switches to practically nothing. Mutants still need to set shader data per object and so are significantly faster than normal primitives, but can't get close to the volume of rendered items that clones can.</p>
<p>For sheer volume, you want clones. For maximum visual uniqueness, it's mutants.</p>
<p>(* Strictly speaking, you can make each instance pretty unique with custom entities and clever shaders. A common technique is to make use of the <code>INSTANCE_ID</code> to provide uniqueness, for example by modulo'ing it to get a fixed number range and then using that to set, say, transparency.)</p>
<h2><a class="anchor" aria-hidden="true" id="trading-off-convenience-for-speed"></a><a href="#trading-off-convenience-for-speed" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Trading off convenience for speed</h2>
<p>Most of Indigo's APIs and primitives are written to be ergonomic, but this is not true of Clones and Mutants, which have far fewer convenience methods.</p>
<p>Why should that be the case?</p>
<p>Indigo's primitives and APIs are designed to be friendly and aren't too concerned about the performance implications of that choice because in general, it's fast enough.</p>
<p>The point of clones and mutants is speed and volume. The easiest way to lose speed in Scala.js/JavaScript is to do many object/memory allocations or use poor data structures for large volumes of entities.</p>
<p>If you allocate a lot, the result is garbage collection pressure, which means GC pauses and poor frame rates.</p>
<p>If you use a <code>List</code> rather than an <code>Array</code>, you end up with <a href="https://docs.scala-lang.org/overviews/collections-2.13/performance-characteristics.html">linear rather than constant speed</a> for the kind of operations we care about.</p>
<h2><a class="anchor" aria-hidden="true" id="performance-considerations"></a><a href="#performance-considerations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Performance considerations</h2>
<p>Using Clones and Mutants is faster than using standard primitives, however, if for instance you construct a <code>CloneBatch</code> of 10,000 elements you might be saddened not to get the performance you were expecting.</p>
<p>The issue is that moving large arrays the various pipeline stages is just expensive, but there are two things you can do to improve performance:</p>
<ol>
<li><p>Make use of static keys to cache data where possible, e.g. <code>CloneBatch().withStaticBatchKey(BindingKey(&quot;my clone data&quot;))</code></p></li>
<li><p>Divide up your data. Instead of one <code>CloneBatch</code> of 10,000 things, try 20 <code>CloneBatch</code>s of 500 things.</p></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="using-clones-and-mutants"></a><a href="#using-clones-and-mutants" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using Clones and Mutants</h2>
<h3><a class="anchor" aria-hidden="true" id="clone-blanks"></a><a href="#clone-blanks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Clone blanks</h3>
<p>Whether you're using clones or mutants, you will need an archetypal entity that your clone/mutant is going to be based on. These are called &quot;clone blanks&quot;.</p>
<p>A clone blank can be any primitive that extends the <code>Cloneable</code> trait, which includes custom entity nodes. Groups and other compound entities cannot be used as clone blanks.</p>
<p>Clone blanks are processed once per frame, and you can add them to your scene as follows:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> indigo.*

<span class="hljs-keyword">val</span> graphic = <span class="hljs-type">Graphic</span>(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-type">Material</span>.<span class="hljs-type">Bitmap</span>(<span class="hljs-type">AssetName</span>(<span class="hljs-string">"bob texture"</span>)))
<span class="hljs-keyword">val</span> cloneId = <span class="hljs-type">CloneId</span>(<span class="hljs-string">"bob"</span>)
<span class="hljs-keyword">val</span> cloneBlank = <span class="hljs-type">CloneBlank</span>(<span class="hljs-type">CloneId</span>(<span class="hljs-string">"bob"</span>), graphic)

<span class="hljs-type">SceneUpdateFragment</span>.empty.addCloneBlanks(cloneBlank)
</code></pre>
<p>The clone ID is used to reference the blank at render time. If the ID isn't found, the clone or mutant instances are skipped.</p>
<h3><a class="anchor" aria-hidden="true" id="clone-batch"></a><a href="#clone-batch" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Clone batch</h3>
<p>The simplest and most high volume type of clone is the <code>CloneBatch</code>.</p>
<p><code>CloneBatch</code> entities allow you to change only basic transform properties of your entity. Your clone blank will be copied once for every instance of the <code>CloneBatchData</code> you provide, which sets the x, y, rotation, scale x and scale y properties of your clone blank entity.</p>
<p>This example will render three instances of the clone blank in different positions on the screen.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> particles = <span class="hljs-type">Batch</span>(<span class="hljs-type">Point</span>(<span class="hljs-number">10</span>), <span class="hljs-type">Point</span>(<span class="hljs-number">20</span>), <span class="hljs-type">Point</span>(<span class="hljs-number">30</span>))

<span class="hljs-type">CloneBatch</span>(
  cloneId,
  particles.map(pt =&gt; <span class="hljs-type">CloneBatchData</span>(pt.x, pt.y))
)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="clone-tiles"></a><a href="#clone-tiles" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Clone tiles</h3>
<p>The problem with <code>CloneBatch</code> is that the copies are pretty much identical - particularly when using Indigo's standard primitives. Meaning you could render 10,000 red dots, but not 10,000 red, green and blue dots (unless you use a custom entity).</p>
<p><code>CloneTiles</code> are almost identical to <code>CloneBatch</code> except that they also allow you to choose a texture crop on a per instance basis. As such they are only really useful with custom entities or <code>Graphic</code>s, but they are very useful nonetheless. For example, one might use them to render large tile based level maps.</p>
<p>This example renders our three instances again but this time crops the texture in three different places.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> crops = <span class="hljs-type">Batch</span>(<span class="hljs-type">Rectangle</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>), <span class="hljs-type">Rectangle</span>(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>), <span class="hljs-type">Rectangle</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>))

<span class="hljs-type">CloneTiles</span>(
  cloneId,
  particles.zip(crops).map { <span class="hljs-keyword">case</span> (p, c) =&gt;
    <span class="hljs-type">CloneTileData</span>(p.x, p.y, <span class="hljs-type">Radians</span>.zero, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, c.x, c.y, c.width, c.height)
  }
)
</code></pre>
<div id="mdoc-html-run2" data-mdoc-js></div>
<h3><a class="anchor" aria-hidden="true" id="mutants"></a><a href="#mutants" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mutants</h3>
<p>The idea of mutants is to take a clone blank and 'mutate' it per instance by providing different data to it's shader program. In theory this makes mutants extremely powerful, as you can render pretty much anything, but this also makes them quite complicated.</p>
<p><code>Mutants</code> are considered an advanced feature, as they are really only useful with custom entities.</p>
<p>From a usage perspective, <code>Mutants</code> are no more difficult to use than <code>CloneBatch</code>s or <code>CloneTiles</code>, here is a simple example that renders a single copy of a clone blank:</p>
<pre><code class="hljs css language-scala"><span class="hljs-type">Mutants</span>(
  cloneId,
  <span class="hljs-type">Array</span>(
    <span class="hljs-type">Batch</span>(
      <span class="hljs-type">UniformBlock</span>(
        <span class="hljs-string">"MutantData"</span>,
        <span class="hljs-type">Batch</span>(
          <span class="hljs-type">Uniform</span>(<span class="hljs-string">"MOVE_TO"</span>)  -&gt; vec2(<span class="hljs-number">10.0</span>, <span class="hljs-number">10.0</span>),
          <span class="hljs-type">Uniform</span>(<span class="hljs-string">"SCALE_TO"</span>) -&gt; vec2(<span class="hljs-number">2.0</span>, <span class="hljs-number">2.0</span>),
          <span class="hljs-type">Uniform</span>(<span class="hljs-string">"ALPHA"</span>)    -&gt; float(<span class="hljs-number">0.75</span>)
        )
      )
    )
  )
)
</code></pre>
<div id="mdoc-html-run3" data-mdoc-js></div>
<p>The idea here is that you have <a href="/docs/guides/howto-custom-entity">created a custom entity</a> and for each instance, you want to set it's UBO data, which here contains a position, a scale and an alpha value.</p>
<p>In many ways the important part of this example is the alpha. If you only wanted to position the entities you be far better off with one of the clone types. The whole point is that you also plan to programmatically influence the visual rendering of the entity in some way.</p>
<p>You will then need a pair of shaders to go with that data.</p>
<p><strong>Vertex:</strong></p>
<pre><code class="hljs css language-glsl"><span class="hljs-meta">#version 300 es</span>

<span class="hljs-keyword">precision</span> <span class="hljs-keyword">mediump</span> <span class="hljs-type">float</span>;

<span class="hljs-type">vec2</span> POSITION;
<span class="hljs-type">vec2</span> SCALE;

<span class="hljs-comment">//&lt;indigo-vertex&gt;</span>
<span class="hljs-keyword">layout</span> (<span class="hljs-keyword">std140</span>) <span class="hljs-keyword">uniform</span> MutantData {
  <span class="hljs-type">vec2</span> MOVE_TO;
  <span class="hljs-type">vec2</span> SCALE_TO;
  <span class="hljs-type">float</span> ALPHA;
};

<span class="hljs-type">void</span> vertex(){
  POSITION = MOVE_TO;
  SCALE = SCALE_TO;
}
<span class="hljs-comment">//&lt;/indigo-vertex&gt;</span>
</code></pre>
<p>This vertex shader takes the position and scale variables and overrides them based on the UBO 'MutantData' provided.</p>
<p><strong>Fragment:</strong></p>
<pre><code class="hljs css language-glsl"><span class="hljs-meta">#version 300 es</span>

<span class="hljs-keyword">precision</span> <span class="hljs-keyword">mediump</span> <span class="hljs-type">float</span>;

<span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> SRC_CHANNEL;

<span class="hljs-type">vec4</span> CHANNEL_0;
<span class="hljs-type">vec4</span> COLOR;

<span class="hljs-comment">//&lt;indigo-fragment&gt;</span>
<span class="hljs-keyword">layout</span> (<span class="hljs-keyword">std140</span>) <span class="hljs-keyword">uniform</span> MutantData {
  <span class="hljs-type">vec2</span> MOVE_TO;
  <span class="hljs-type">vec2</span> SCALE_TO;
  <span class="hljs-type">float</span> ALPHA;
};

<span class="hljs-type">void</span> fragment(){
  <span class="hljs-type">float</span> a = CHANNEL_0.a * ALPHA;
  COLOR = <span class="hljs-type">vec4</span>(CHANNEL_0.rgb * a, a);
}
<span class="hljs-comment">//&lt;/indigo-fragment&gt;</span>
</code></pre>
<p>The fragment shader takes the default texture channel and applies the supplied alpha to it. Note the use of <a href="/docs/shaders/premultiplied-alpha">premultiplied alpha</a>.</p>
<script type="text/javascript" src="clones-and-mutants.md.js" defer></script>
<script type="text/javascript" src="mdoc.js" defer></script>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/presentation/cameras"><span class="arrow-prev">← </span><span>Cameras</span></a><a class="docs-next button" href="/docs/presentation/depth"><span>Depth</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#clones-vs-mutants">Clones vs Mutants</a></li><li><a href="#trading-off-convenience-for-speed">Trading off convenience for speed</a></li><li><a href="#performance-considerations">Performance considerations</a></li><li><a href="#using-clones-and-mutants">Using Clones and Mutants</a><ul class="toc-headings"><li><a href="#clone-blanks">Clone blanks</a></li><li><a href="#clone-batch">Clone batch</a></li><li><a href="#clone-tiles">Clone tiles</a></li><li><a href="#mutants">Mutants</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/indigo_logo.svg" alt="Indigo" width="66" height="58"/></a><div><h5>Getting Started</h5><a href="/docs/en/quickstart/setup-and-configuration">Setup &amp; Configuration Guide</a><a href="/docs/en/quickstart/hello-indigo">&quot;Hello, Indigo!&quot; Tutorial</a><a href="/docs/en/quickstart/examples">Links to examples</a><a href="/docs/en/quickstart/project-templates">Project templates</a></div><div><h5>Community</h5><a href="https://discord.gg/b5CD47g">Discord</a><a href="https://github.com/PurpleKingdomGames/indigo/discussions">GitHub Discussons</a><a href="https://twitter.com/indigoengine" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>Sponsor us!</h5><a href="https://github.com/sponsors/PurpleKingdomGames">GitHub Sponsors</a><a href="https://www.patreon.com/indigoengine">Patreon</a></div></section></footer></div></body></html>