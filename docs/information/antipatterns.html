<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Anti-Patterns · Indigo</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="This page is an attempt to flag any anti-patterns, bad practices or traps that the authors have seen in the wild or have themselves fallen into! The hope is that but not repeating these mistakes your game dev&#x27;ving will be more fun and fruitful."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Anti-Patterns · Indigo"/><meta property="og:type" content="website"/><meta property="og:url" content="https://your-docusaurus-test-site.com/"/><meta property="og:description" content="This page is an attempt to flag any anti-patterns, bad practices or traps that the authors have seen in the wild or have themselves fallen into! The hope is that but not repeating these mistakes your game dev&#x27;ving will be more fun and fruitful."/><meta property="og:image" content="https://your-docusaurus-test-site.com/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://your-docusaurus-test-site.com/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/indigo_logo_solid.svg"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://your-docusaurus-test-site.com/blog/atom.xml" title="Indigo Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://your-docusaurus-test-site.com/blog/feed.xml" title="Indigo Blog RSS Feed"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-169190516-1"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'UA-169190516-1');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/indigo_logo_solid_text.svg" alt="Indigo"/><h2 class="headerTitleWithLogo">Indigo</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="/docs/guides" target="_self">Guides</a></li><li class="siteNavGroupActive"><a href="/docs/development-status" target="_self">Docs</a></li><li class=""><a href="/api/" target="_self">APIs</a></li><li class=""><a href="/tools" target="_self">Tools</a></li><li class=""><a href="https://github.com/PurpleKingdomGames/indigo" target="_blank">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Other information</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Indigo</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/development-status">Indigo&#x27;s Development Status</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/quickstart/setup-and-configuration">Setup &amp; Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/quickstart/hello-indigo">Hello, Indigo!</a></li><li class="navListItem"><a class="navItem" href="/docs/quickstart/examples">Examples</a></li><li class="navListItem"><a class="navItem" href="/docs/quickstart/project-templates">Mill &amp; SBT Game Templates</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Organising your game</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/organisation/boot-and-start-up">Boot &amp; Start Up</a></li><li class="navListItem"><a class="navItem" href="/docs/organisation/game-entry-points">Game Entry Points</a></li><li class="navListItem"><a class="navItem" href="/docs/organisation/scene-management">Scenes &amp; Scene Management</a></li><li class="navListItem"><a class="navItem" href="/docs/organisation/subsystems">SubSystems</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">The game loop</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/gameloop/events">Events</a></li><li class="navListItem"><a class="navItem" href="/docs/gameloop/frame-context">Frame context</a></li><li class="navListItem"><a class="navItem" href="/docs/gameloop/outcome">Outcome Type</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Presentation</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/presentation/animation">Animation</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/audio">Audio</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/boundaries">Boundaries</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/cameras">Cameras</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/clones-and-mutants">Clones &amp; Mutants</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/depth">Depth</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/layers">Layers</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/lighting">Lighting</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/materials">Materials</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/primitives">Primitives &amp; Building Blocks</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/scene-update-fragment">SceneUpdateFragment</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/shapes">Shapes</a></li><li class="navListItem"><a class="navItem" href="/docs/presentation/text-and-fonts">Text &amp; Fonts</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">UI Components</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/uicomponents/ui-components">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/uicomponents/button">Buttons</a></li><li class="navListItem"><a class="navItem" href="/docs/uicomponents/hit-area">Hit Area</a></li><li class="navListItem"><a class="navItem" href="/docs/uicomponents/input-field">Input Field</a></li><li class="navListItem"><a class="navItem" href="/docs/uicomponents/radio-button">Radio Button</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Shaders</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/shaders/shader-overview">Shaders Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/shaders/constants">Shader Constants, Variables, and Outputs</a></li><li class="navListItem"><a class="navItem" href="/docs/shaders/blending">Blending</a></li><li class="navListItem"><a class="navItem" href="/docs/shaders/premultiplied-alpha">Premultiplied Alpha</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Working with Time</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/time/signals">Signals &amp; Signal Functions</a></li><li class="navListItem"><a class="navItem" href="/docs/time/time-varying-values">Time Varying Values</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Platform &amp; Publishing</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/platform/assets">Assets &amp; Asset Loading</a></li><li class="navListItem"><a class="navItem" href="/docs/platform/cross-platform-publishing">Cross Platform Publishing</a></li><li class="navListItem"><a class="navItem" href="/docs/platform/importers">File Format Importers</a></li><li class="navListItem"><a class="navItem" href="/docs/platform/input-handling">User Input Handling</a></li><li class="navListItem"><a class="navItem" href="/docs/platform/loading-and-saving-data">Loading &amp; Saving Data</a></li><li class="navListItem"><a class="navItem" href="/docs/platform/logging">Logging</a></li><li class="navListItem"><a class="navItem" href="/docs/platform/networking">Networking</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Other information</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/information/alternatives">Alternatives to Indigo</a></li><li class="navListItem"><a class="navItem" href="/docs/information/glossary">Glossary</a></li><li class="navListItem"><a class="navItem" href="/docs/information/key-concepts">Key Concepts</a></li><li class="navListItem"><a class="navItem" href="/docs/information/model-viewmodel-view">Model, ViewModel, &amp; View</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/information/antipatterns">Anti-Patterns</a></li><li class="navListItem"><a class="navItem" href="/docs/information/motivation-and-constraints">Motivation &amp; Constraints</a></li><li class="navListItem"><a class="navItem" href="/docs/information/performance">Performance</a></li><li class="navListItem"><a class="navItem" href="/docs/information/prior-art">Prior Art</a></li><li class="navListItem"><a class="navItem" href="/docs/information/rendering-technology">Rendering Technology</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Anti-Patterns</h1></header><article><div><span><p>This page is an attempt to flag any anti-patterns, bad practices or traps that the authors have seen in the wild or have themselves fallen into! The hope is that but not repeating these mistakes your game dev'ving will be more fun and fruitful.</p>
<h2><a class="anchor" aria-hidden="true" id="general-advice"></a><a href="#general-advice" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>General advice</h2>
<h3><a class="anchor" aria-hidden="true" id="uni-directional-data-flows"></a><a href="#uni-directional-data-flows" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Uni-directional data flows</h3>
<p>The main thing to remember when building in Indigo is that is follows a uni-directional data flow. That is to say that the data all goes in one direction.</p>
<h2><a class="anchor" aria-hidden="true" id="anti-patterns-and-traps"></a><a href="#anti-patterns-and-traps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Anti-patterns and traps</h2>
<h3><a class="anchor" aria-hidden="true" id="feedback"></a><a href="#feedback" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Feedback</h3>
<p>A common thing to do, is to organise your game model into a hierarchy of classes/objects, and then have methods that delegate or invoke methods on their sub-objects who in turn need to somehow update their parent. As you can imagine, this can get very hairy very quickly.</p>
<h4><a class="anchor" aria-hidden="true" id="example-health-potions"></a><a href="#example-health-potions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example: Health potions</h4>
<p>In your game, all characters - player or otherwise - have an inventory and so you decide to model it like this:</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Character</span></span>:
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">inventory</span></span>: <span class="hljs-type">Inventory</span>

<span class="hljs-keyword">final</span> <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Player</span>(<span class="hljs-params">health: <span class="hljs-type">Int</span>, inventory: <span class="hljs-type">Inventory</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">Character</span></span>
</code></pre>
<p>Your player can can pick up health potions around the game and store them in their inventory, which can only hold one health potion at a time. Lets model the inventory as dumbly as possible to keep this really simple:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">HealthPotion</span></span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Inventory</span>(<span class="hljs-params">healthPotion: <span class="hljs-type">Option</span>[<span class="hljs-type">HealthPotion</span>]</span>)</span>:

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span></span>(hp: <span class="hljs-type">HealthPotion</span>): <span class="hljs-type">Inventory</span> = 
    <span class="hljs-keyword">this</span>.copy(healthPotion = <span class="hljs-type">Some</span>(hp))

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">use</span></span>: <span class="hljs-type">Inventory</span> =
    healthPotion <span class="hljs-keyword">match</span>
      <span class="hljs-keyword">case</span> <span class="hljs-type">None</span> =&gt; <span class="hljs-keyword">this</span>
      <span class="hljs-keyword">case</span> <span class="hljs-type">Some</span>(hp) =&gt; <span class="hljs-keyword">this</span>.copy(healthPotion = <span class="hljs-type">None</span>)
</code></pre>
<p>We've given it nice little <code>add</code> and <code>use</code> methods too! While we're at it, the player needs updating:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">final</span> <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Player</span>(<span class="hljs-params">health: <span class="hljs-type">Int</span>, inventory: <span class="hljs-type">Inventory</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">Character</span></span>:

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span></span>(hp: <span class="hljs-type">HealthPotion</span>): <span class="hljs-type">Player</span> =
    <span class="hljs-keyword">this</span>.copy(inventory = inventory.add(hp))

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">use</span></span>: <span class="hljs-type">Player</span> =
    <span class="hljs-keyword">this</span>.copy(inventory = inventory.use)
</code></pre>
<p>Now you can call <code>add</code> or <code>use</code> on player and it delegates through to the inventory and everything is immutably updated. Great.</p>
<p>...there's some problems here though, lets look at two in particular:</p>
<ol>
<li><p>What if we're already carrying a health potion and we try and insert another one?</p></li>
<li><p>The <code>use</code> method certainly removes the health potion from our possession, but how do we update the players health?</p></li>
</ol>
<p>The anti-pattern is to try and feedback to the parent directly, consider these modifications to our inventory methods:</p>
<pre><code class="hljs css language-diff"><span class="hljs-deletion">-def add(hp: HealthPotion): Inventory</span>
<span class="hljs-addition">+def add(hp: HealthPotion): (Inventory, Boolean)</span>
</code></pre>
<p>Here we are adding a boolean to the return type to say &quot;succeeded in adding the potion&quot; (or not).</p>
<pre><code class="hljs css language-diff"><span class="hljs-deletion">-def use: Inventory</span>
<span class="hljs-addition">+def use(player: Player): (Inventory, Player)</span>
</code></pre>
<p>Here again we're going to inflate the return type so that now we can accept the player (our parent object), fiddle with it, and give it back... to itself... yuk!</p>
<h4><a class="anchor" aria-hidden="true" id="solution-events"></a><a href="#solution-events" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Solution: Events</h4>
<p>Instead of doing any weird feedback with the return types, we can just use the <code>Outcome</code> type to fire off events, consider the following alternate inventory implementation:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">final</span> <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CannotAddThis</span>(<span class="hljs-params">healthPotion: <span class="hljs-type">HealthPotion</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">GlobalEvent</span></span>
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">NoHealthPotionToUse</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GlobalEvent</span></span>
<span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IncreasePlayerHealth</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GlobalEvent</span></span>

<span class="hljs-keyword">final</span> <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Inventory</span>(<span class="hljs-params">healthPotion: <span class="hljs-type">Option</span>[<span class="hljs-type">HealthPotion</span>]</span>)</span>:

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span></span>(hp: <span class="hljs-type">HealthPotion</span>): <span class="hljs-type">Outcome</span>[<span class="hljs-type">Inventory</span>] =
    healthPotion <span class="hljs-keyword">match</span>
      <span class="hljs-keyword">case</span> <span class="hljs-type">None</span> =&gt;
        <span class="hljs-type">Outcome</span>(<span class="hljs-keyword">this</span>.copy(healthPotion = <span class="hljs-type">Some</span>(hp)))

      <span class="hljs-keyword">case</span> <span class="hljs-type">Some</span>(_) =&gt;
        <span class="hljs-type">Outcome</span>(<span class="hljs-keyword">this</span>)
          .addGlobalEvents(<span class="hljs-type">CannotAddThis</span>(hp))

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">use</span></span>: <span class="hljs-type">Outcome</span>[<span class="hljs-type">Inventory</span>] =
    healthPotion <span class="hljs-keyword">match</span>
      <span class="hljs-keyword">case</span> <span class="hljs-type">None</span> =&gt;
        <span class="hljs-type">Outcome</span>(<span class="hljs-keyword">this</span>)
          .addGlobalEvents(<span class="hljs-type">NoHealthPotionToUse</span>)

      <span class="hljs-keyword">case</span> <span class="hljs-type">Some</span>(hp) =&gt;
        <span class="hljs-type">Outcome</span>(<span class="hljs-keyword">this</span>.copy(healthPotion = <span class="hljs-type">None</span>))
          .addGlobalEvents(<span class="hljs-type">IncreasePlayerHealth</span>)
</code></pre>
<p>Now, when we consume a health potion we either report that there was one, or that the players health should be increased. Equally if we try to add a potion to an already full inventory, we report the problem and return the item. The events are collected on the next frame and actioned.</p>
<p>This will require a change to our player too to make it work:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">final</span> <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Player</span>(<span class="hljs-params">health: <span class="hljs-type">Int</span>, inventory: <span class="hljs-type">Inventory</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">Character</span></span>:

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span></span>(hp: <span class="hljs-type">HealthPotion</span>): <span class="hljs-type">Outcome</span>[<span class="hljs-type">Player</span>] =
    inventory.add(hp).map { inv =&gt;
      <span class="hljs-keyword">this</span>.copy(inventory = inv)
    }

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">use</span></span>: <span class="hljs-type">Outcome</span>[<span class="hljs-type">Player</span>] =
    inventory.use.map { inv =&gt;
      <span class="hljs-keyword">this</span>.copy(inventory = inv)
    }
</code></pre>
<p>When we call <code>use</code>, it now returns an <code>Outcome[Inventory]</code> which we can map over (retaining any events created when we called <code>inventory.use</code>) and update our player.</p>
<p>Note that we don't try and update the player's health yet. To do that we'd add a new <code>increaseHealth</code> method to <code>Player</code> and have it invoked when the <code>updateModel</code> function receives the <code>IncreasePlayerHealth</code> event.</p>
<h3><a class="anchor" aria-hidden="true" id="simultaneous-updates"></a><a href="#simultaneous-updates" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Simultaneous updates</h3>
<p>One place where uni-directional data flows begin to feel awkward and difficult, is when you need to update two things at once, where one's update depends on the other's update.</p>
<h4><a class="anchor" aria-hidden="true" id="example-moving-bad-guys"></a><a href="#example-moving-bad-guys" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example: Moving bad guys</h4>
<p>There are two bad guys moving on a grid towards the player. There is only one empty space in front of the player, but on the next turn, both bad guys could walk into that space, <em>unless</em> they were blocked by the other. Mapping over a list of bad guys is not sufficient because a <code>map</code> operation doesn't know how it's neighbours have been affected, and can only have the previous positions as context. In other words, if you just did <code>badguys.map(move)</code> they'd both end up in the same space.</p>
<p>What can you do?</p>
<h4><a class="anchor" aria-hidden="true" id="solution-recursion"></a><a href="#solution-recursion" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Solution: Recursion</h4>
<p>If the updates must happen right now on this frame, then one solution is recursion. By processing each bad guy in turn and having the context of the updated bad guys so far available, you can avoid collisions.</p>
<p>In pseudo-scala code:</p>
<pre><code class="hljs css language-scala"><span class="hljs-meta">@tailrec</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">moveBadGuys</span></span>(notMoved: <span class="hljs-type">List</span>[<span class="hljs-type">BadGuy</span>], moved: <span class="hljs-type">List</span>[<span class="hljs-type">BadGuy</span>]): <span class="hljs-type">List</span>[<span class="hljs-type">BadGuy</span>] =
  notMoved <span class="hljs-keyword">match</span>
    <span class="hljs-keyword">case</span> <span class="hljs-type">Nil</span> =&gt; moved
    <span class="hljs-keyword">case</span> nextBadGuy :: remainingBadGuys =&gt;
      <span class="hljs-keyword">val</span> nextPosition =
        <span class="hljs-comment">// decide next position while checking for conflicts</span>
        <span class="hljs-comment">// within `moved`.</span>
        ???
      moveBadGuys(remainingBadGuys, nextBadGuy.move(nextPosition) :: moved)
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/information/model-viewmodel-view"><span class="arrow-prev">← </span><span class="function-name-prevnext">Model, ViewModel, &amp; View</span></a><a class="docs-next button" href="/docs/information/motivation-and-constraints"><span>Motivation &amp; Constraints</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#general-advice">General advice</a><ul class="toc-headings"><li><a href="#uni-directional-data-flows">Uni-directional data flows</a></li></ul></li><li><a href="#anti-patterns-and-traps">Anti-patterns and traps</a><ul class="toc-headings"><li><a href="#feedback">Feedback</a></li><li><a href="#simultaneous-updates">Simultaneous updates</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/indigo_logo.svg" alt="Indigo" width="66" height="58"/></a><div><h5>Getting Started</h5><a href="/docs/en/quickstart/setup-and-configuration">Setup &amp; Configuration Guide</a><a href="/docs/en/quickstart/hello-indigo">&quot;Hello, Indigo!&quot; Tutorial</a><a href="/docs/en/quickstart/examples">Links to examples</a><a href="/docs/en/quickstart/project-templates">Project templates</a></div><div><h5>Community</h5><a href="https://discord.gg/b5CD47g">Discord</a><a href="https://github.com/PurpleKingdomGames/indigo/discussions">GitHub Discussons</a><a href="https://twitter.com/indigoengine" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>Sponsor us!</h5><a href="https://github.com/sponsors/PurpleKingdomGames">GitHub Sponsors</a><a href="https://www.patreon.com/indigoengine">Patreon</a></div></section></footer></div></body></html>