<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.110.0">
    <meta name="description" content="Elm inspired Scala Web Framework">
<meta name="author" content="Dave Smith">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Networking - Tyrian</title>

    
    <link href="/css/nucleus.css?1675541392" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1675541392" rel="stylesheet">
    <link href="/css/hybrid.css?1675541392" rel="stylesheet">
    <link href="/css/featherlight.min.css?1675541392" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1675541392" rel="stylesheet">
    <link href="/css/auto-complete.css?1675541392" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1675541392" rel="stylesheet">
    <link href="/css/theme.css?1675541392" rel="stylesheet">
    <link href="/css/tabs.css?1675541392" rel="stylesheet">
    <link href="/css/hugo-theme.css?1675541392" rel="stylesheet">
    
    <link href="/css/theme-tyrian.css?1675541392" rel="stylesheet">
    
    <link href="/css/foo.css?1675541392" rel="stylesheet"><link href="/css/bar.css?1675541392" rel="stylesheet">

    <script src="/js/jquery-3.3.1.min.js?1675541392"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/concepts/networking/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <img src='/images/tyrian-menu-logo.svg' style="width:75%" alt="Tyrian logo">

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1675541392"></script>
<script type="text/javascript" src="/js/auto-complete.js?1675541392"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/tyrian.indigoengine.io\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1675541392"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/installation/" title="Setup &amp; Configuration" class="dd-item
        
        
        
        ">
      <a href="/installation/">
          Installation
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/architecture/" title="Architecture &amp; Patterns" class="dd-item
        
        
        
        ">
      <a href="/architecture/">
          Architecture
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/concepts/" title="Core Concepts" class="dd-item
        parent
        
        
        ">
      <a href="/concepts/">
          Core Concepts
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/concepts/guided-tour/" title="A Guided Example" class="dd-item ">
        <a href="/concepts/guided-tour/">
        Guided Example
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/concepts/bundling/" title="Building &amp; Bundling" class="dd-item ">
        <a href="/concepts/bundling/">
        Bundling
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/concepts/goodies/" title="Built-in Goodies" class="dd-item ">
        <a href="/concepts/goodies/">
        Goodies
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/concepts/cmd/" title="Commands &amp; Effects" class="dd-item ">
        <a href="/concepts/cmd/">
        Commands
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/concepts/networking/" title="Networking" class="dd-item active">
        <a href="/concepts/networking/">
        Networking
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/concepts/html/" title="Rendering HTML" class="dd-item ">
        <a href="/concepts/html/">
        Rendering HTML
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/concepts/ssr/" title="Server-side Rendering (SSR)" class="dd-item ">
        <a href="/concepts/ssr/">
        Server-side Rendering
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/concepts/subs/" title="Subscriptions" class="dd-item ">
        <a href="/concepts/subs/">
        Subscriptions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/concepts/tyrian-indigo-bridge/" title="Tyrian-Indigo Bridge" class="dd-item ">
        <a href="/concepts/tyrian-indigo-bridge/">
        Tyrian &#43; Indigo 
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/examples/" title="Examples" class="dd-item
        
        
        
        ">
      <a href="/examples/">
          Examples
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/information/" title="Information &amp; Trivia" class="dd-item
        
        
        
        ">
      <a href="/information/">
          Information
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://github.com/PurpleKingdomGames/tyrian"><i class='fab fa-github'></i> Github</a>
              </li>
          
              <li>
                  <a class="padding" href="https://tyrian.indigoengine.io/api/"><i class='fas fa-bookmark'></i> Tyrian API Docs</a>
              </li>
          
              <li>
                  <a class="padding" href="https://github.com/sponsors/PurpleKingdomGames"><i class='fas fa-bullhorn'></i> GitHub Sponsors</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/PurpleKingdomGames/tyrian/tree/main/docs/concepts/networking.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Tyrian</a> > <a href='/concepts/'>Core Concepts</a> > Networking
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#http">Http</a>
      <ul>
        <li><a href="#fetch-random-gif-via-http">Fetch random GIF via HTTP</a></li>
        <li><a href="#http4s-dom-integration">Http4s-dom integration</a></li>
      </ul>
    </li>
    <li><a href="#web-sockets">Web Sockets</a>
      <ul>
        <li><a href="#ws-echo-server">WS echo server</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Networking
            </h1>
          

        


<p>Out of the box, Tyrian supports two flavors of networking, <a href="https://github.com/PurpleKingdomGames/tyrian/tree/main/examples">HTTP and Web Sockets</a>, and we have examples you can run of both. Please see the instructions in the README file.</p>
<p>It should be said that both implementations are quite primitive at the time of writing. Contributions in the form of issues and improvements are very welcome in this area. No doubt they will be improved as the need arises.</p>
<h2 id="http">Http</h2>
<p><code>tyrian.http.Http</code> is a built-in <code>Cmd</code> that defines the following method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Http</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#66d9ef">send</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Async</span>, <span style="color:#66d9ef">A</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">](</span>
</span></span><span style="display:flex;"><span>    request<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Request</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">],</span>
</span></span><span style="display:flex;"><span>    resultToMessage<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Decoder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Msg</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Cmd</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Additionally, Tyrian also integrates with <a href="https://github.com/http4s/http4s-dom">http4s-dom</a>.</p>
<h3 id="fetch-random-gif-via-http">Fetch random GIF via HTTP</h3>
<p>Assuming the following imports:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> cats.effect.IO
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> cats.syntax.either.<span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> io.circe.HCursor
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> io.circe.parser.<span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> tyrian.<span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> tyrian.cmds.<span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> tyrian.http.<span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> tyrian.Html.<span style="color:#f92672">*</span>
</span></span></code></pre></div><p>Let&rsquo;s walk through this example starting with the <code>Model1</code> and <code>Msg1</code> types.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Model1</span><span style="color:#f92672">(</span>topic<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span> gifUrl<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>enum <span style="color:#a6e22e">Msg1</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">MorePlease</span>              <span style="color:#66d9ef">extends</span> <span style="color:#66d9ef">Msg1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">NewGif</span><span style="color:#f92672">(</span>result<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span>  <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Msg1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">GifError</span><span style="color:#f92672">(</span>error<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Msg1</span>
</span></span></code></pre></div><p>Followed by a <code>Decoder[Msg1]</code> needed to parse the HTTP responses.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Msg1</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#66d9ef">jsonDecode</span><span style="color:#f92672">(</span><span style="color:#66d9ef">hcursor:</span> <span style="color:#66d9ef">HCursor</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    hcursor
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>downField<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;data&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>downField<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;images&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>downField<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;downsized_medium&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>get<span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">](</span><span style="color:#e6db74">&#34;url&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>toOption
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>toRight<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;wrong json format&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> onResponse<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Response</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">Msg1</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span> response <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>    parse<span style="color:#f92672">(</span>response<span style="color:#f92672">.</span>body<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>leftMap<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>message<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>flatMap<span style="color:#f92672">(</span>j <span style="color:#66d9ef">=&gt;</span> jsonDecode<span style="color:#f92672">(</span>j<span style="color:#f92672">.</span>hcursor<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>fold<span style="color:#f92672">(</span><span style="color:#a6e22e">Msg1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">GifError</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">),</span> <span style="color:#a6e22e">Msg1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">NewGif</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> onError<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HttpError</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">Msg1</span> <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>    e <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Msg1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">GifError</span><span style="color:#f92672">(</span>e<span style="color:#f92672">.</span>toString<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> fromHttpResponse<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Decoder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Msg1</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Decoder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Msg1</span><span style="color:#f92672">](</span>onResponse<span style="color:#f92672">,</span> onError<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Next we have an <code>HttpHelper</code> that invokes the <code>Http.send</code> method using Giphy&rsquo;s API.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">HttpHelper</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#66d9ef">url</span><span style="color:#f92672">(</span><span style="color:#66d9ef">topic:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">s&#34;https://api.giphy.com/v1/gifs/random?api_key=dc6zaTOxFJmzC&amp;tag=</span><span style="color:#e6db74">$topic</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> getRandomGif<span style="color:#f92672">(</span>topic<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Cmd</span><span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span>, <span style="color:#66d9ef">Msg1</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Http</span><span style="color:#f92672">.</span>send<span style="color:#f92672">(</span><span style="color:#a6e22e">Request</span><span style="color:#f92672">.</span>get<span style="color:#f92672">(</span>url<span style="color:#f92672">(</span>topic<span style="color:#f92672">)),</span> <span style="color:#a6e22e">Msg1</span><span style="color:#f92672">.</span>fromHttpResponse<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Ultimately, we can use it in our <code>init</code> and <code>update</code> methods, or anywhere where a <code>Cmd[IO, Msg1]</code> is expected. For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">HttpMain</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#66d9ef">init</span><span style="color:#f92672">(</span><span style="color:#66d9ef">flags:</span> <span style="color:#66d9ef">Map</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">String</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">Model1</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">Cmd</span><span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span>, <span style="color:#66d9ef">Msg1</span><span style="color:#f92672">])</span> <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">(</span><span style="color:#a6e22e">Model1</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cats&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;waiting.gif&#34;</span><span style="color:#f92672">),</span> <span style="color:#a6e22e">HttpHelper</span><span style="color:#f92672">.</span>getRandomGif<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cats&#34;</span><span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> update<span style="color:#f92672">(</span>model<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Model1</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Msg1</span> <span style="color:#f92672">=&gt;</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">Model1</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">Cmd</span><span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span>, <span style="color:#66d9ef">Msg1</span><span style="color:#f92672">])</span> <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Msg1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">MorePlease</span>     <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">(</span>model<span style="color:#f92672">,</span> <span style="color:#a6e22e">HttpHelper</span><span style="color:#f92672">.</span>getRandomGif<span style="color:#f92672">(</span>model<span style="color:#f92672">.</span>topic<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Msg1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">NewGif</span><span style="color:#f92672">(</span>newUrl<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">(</span>model<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>gifUrl <span style="color:#66d9ef">=</span> newUrl<span style="color:#f92672">),</span> <span style="color:#a6e22e">Cmd</span><span style="color:#f92672">.</span><span style="color:#a6e22e">None</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Msg1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">GifError</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>    <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">(</span>model<span style="color:#f92672">,</span> <span style="color:#a6e22e">Cmd</span><span style="color:#f92672">.</span><span style="color:#a6e22e">None</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><!-- raw HTML omitted -->
<p>You can find the full code on the examples directory linked at the top.</p>
<h3 id="http4s-dom-integration">Http4s-dom integration</h3>
<p>To use <code>http4s-dom</code> instead, we only need to replace the <code>HttpHelper</code> with the following implementation.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> io.circe.<span style="color:#f92672">{</span> <span style="color:#a6e22e">Decoder</span> as <span style="color:#a6e22e">JsonDecoder</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">DecodingFailure</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.http4s.circe.CirceEntityCodec.<span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.http4s.dom.FetchClientBuilder
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Http4sDomHelper</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> <span style="color:#66d9ef">client</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">FetchClientBuilder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span><span style="color:#f92672">].</span>create
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  given <span style="color:#a6e22e">JsonDecoder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Msg1</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">JsonDecoder</span><span style="color:#f92672">.</span>instance <span style="color:#f92672">{</span> c <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Msg1</span><span style="color:#f92672">.</span>jsonDecode<span style="color:#f92672">(</span>c<span style="color:#f92672">).</span>map<span style="color:#f92672">(</span><span style="color:#a6e22e">Msg1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">NewGif</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)).</span>leftMap<span style="color:#f92672">(</span>e <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">DecodingFailure</span><span style="color:#f92672">(</span>e<span style="color:#f92672">,</span> c<span style="color:#f92672">.</span>history<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> getRandomGif<span style="color:#f92672">(</span>topic<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Cmd</span><span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span>, <span style="color:#66d9ef">Msg1</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> fetchGif<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">IO</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Msg1</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>      client
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>expect<span style="color:#f92672">[</span><span style="color:#66d9ef">Msg1</span><span style="color:#f92672">](</span><span style="color:#a6e22e">HttpHelper</span><span style="color:#f92672">.</span>url<span style="color:#f92672">(</span>topic<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>handleError<span style="color:#f92672">(</span>e <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Msg1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">GifError</span><span style="color:#f92672">(</span>e<span style="color:#f92672">.</span>getMessage<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Cmd</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Run</span><span style="color:#f92672">(</span>fetchGif<span style="color:#f92672">)(</span>identity<span style="color:#f92672">)</span>
</span></span></code></pre></div><!-- raw HTML omitted -->
<h2 id="web-sockets">Web Sockets</h2>
<p>Another built-in command is <code>tyrian.websocket.WebSocket</code>, which has a more complex API.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WebSocket</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Async</span><span style="color:#f92672">](</span>liveSocket<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">LiveSocket</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#66d9ef">disconnect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Msg</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Cmd</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> publish<span style="color:#f92672">[</span><span style="color:#66d9ef">Msg</span><span style="color:#f92672">](</span>message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Cmd</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> subscribe<span style="color:#f92672">[</span><span style="color:#66d9ef">Msg</span><span style="color:#f92672">](</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">WebSocketEvent</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">Msg</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Sub</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/** The running instance of the WebSocket */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LiveSocket</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Async</span><span style="color:#f92672">](</span><span style="color:#66d9ef">val</span> socket<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">dom.WebSocket</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">val</span> subs<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Sub</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span>, <span style="color:#66d9ef">WebSocketEvent</span><span style="color:#f92672">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">WebSocket</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#66d9ef">connect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Async</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">](</span>
</span></span><span style="display:flex;"><span>    address<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    onOpenMessage<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    keepAliveSettings<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">KeepAliveSettings</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">)(</span>
</span></span><span style="display:flex;"><span>    resultToMessage<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">WebSocketConnect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Msg</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Cmd</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Having a <code>WebSocket</code> instance allows us to <code>publish</code> messages (<code>Cmd[F, Msg]</code>), <code>subscribe</code> to events (<code>Sub[F, Msg]</code>), and explicitly <code>disconnect</code> (another <code>Cmd[F, Msg]</code>) from the server. To initiate a connection, we can use any of the available <code>connect</code> methods defined on its companion object.</p>
<h3 id="ws-echo-server">WS echo server</h3>
<p>The following example demonstrates the usage of <code>WebSocket</code>, starting with the following imports:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> cats.effect.IO
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> tyrian.Html.<span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> tyrian.<span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> tyrian.cmds.Logger
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> tyrian.websocket.<span style="color:#f92672">*</span>
</span></span></code></pre></div><p>Next we have the <code>Msg</code> and <code>Model</code> types.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>enum <span style="color:#a6e22e">Msg</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">FromSocket</span><span style="color:#f92672">(</span><span style="color:#66d9ef">message:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">ToSocket</span><span style="color:#f92672">(</span><span style="color:#66d9ef">message:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">WebSocketStatus</span><span style="color:#f92672">(</span><span style="color:#66d9ef">status:</span> <span style="color:#66d9ef">EchoSocket.Status</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#66d9ef">Model</span><span style="color:#f92672">(</span><span style="color:#66d9ef">echoSocket:</span> <span style="color:#66d9ef">EchoSocket</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">log:</span> <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Model</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">val</span> <span style="color:#66d9ef">init:</span> <span style="color:#66d9ef">Model</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Model</span><span style="color:#f92672">(</span><span style="color:#a6e22e">EchoSocket</span><span style="color:#f92672">.</span>init<span style="color:#f92672">,</span> <span style="color:#a6e22e">Nil</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Followed by a custom <code>EchoSocket</code> class that handles the connection by reacting to <code>EchoSocket.Status</code> messages. The handling of the <code>Connecting</code> message is of particular interest, as it initiates the socket connection via <code>WebSocket.connect</code>, including keep-alive settings.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EchoSocket</span><span style="color:#f92672">(</span>socketUrl<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span> socket<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">WebSocket</span><span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span><span style="color:#f92672">]])</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#66d9ef">connectDisconnectButton</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> socket<span style="color:#f92672">.</span>nonEmpty then
</span></span><span style="display:flex;"><span>      button<span style="color:#f92672">(</span>onClick<span style="color:#f92672">(</span><span style="color:#a6e22e">EchoSocket</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Status</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Disconnecting</span><span style="color:#f92672">.</span>asMsg<span style="color:#f92672">))(</span><span style="color:#e6db74">&#34;Disconnect&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> button<span style="color:#f92672">(</span>onClick<span style="color:#f92672">(</span><span style="color:#a6e22e">EchoSocket</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Status</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Connecting</span><span style="color:#f92672">.</span>asMsg<span style="color:#f92672">))(</span><span style="color:#e6db74">&#34;Connect&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> update<span style="color:#f92672">(</span>status<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EchoSocket.Status</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">EchoSocket</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">Cmd</span><span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">])</span> <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>    status <span style="color:#66d9ef">match</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">EchoSocket</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Status</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ConnectionError</span><span style="color:#f92672">(</span>err<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">Logger</span><span style="color:#f92672">.</span>error<span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;Failed to open WebSocket connection: </span><span style="color:#e6db74">$err</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">EchoSocket</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Status</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Connected</span><span style="color:#f92672">(</span>ws<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>socket <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>ws<span style="color:#f92672">)),</span> <span style="color:#a6e22e">Cmd</span><span style="color:#f92672">.</span><span style="color:#a6e22e">None</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">EchoSocket</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Status</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Connecting</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> connect <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">WebSocket</span><span style="color:#f92672">.</span>connect<span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">](</span>
</span></span><span style="display:flex;"><span>            address <span style="color:#66d9ef">=</span> socketUrl<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>            onOpenMessage <span style="color:#66d9ef">=</span> <span style="color:#e6db74">&#34;Connect me!&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>            keepAliveSettings <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">KeepAliveSettings</span><span style="color:#f92672">.</span>default
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">WebSocketConnect</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Error</span><span style="color:#f92672">(</span>err<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">EchoSocket</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Status</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ConnectionError</span><span style="color:#f92672">(</span>err<span style="color:#f92672">).</span>asMsg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">WebSocketConnect</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Socket</span><span style="color:#f92672">(</span>ws<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">EchoSocket</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Status</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Connected</span><span style="color:#f92672">(</span>ws<span style="color:#f92672">).</span>asMsg
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> connect<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">EchoSocket</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Status</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Disconnecting</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> log <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Logger</span><span style="color:#f92672">.</span>info<span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span><span style="color:#f92672">](</span><span style="color:#e6db74">&#34;Graceful shutdown of EchoSocket connection&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> cmds <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>          socket<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>ws <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Cmd</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Batch</span><span style="color:#f92672">(</span>log<span style="color:#f92672">,</span> ws<span style="color:#f92672">.</span>disconnect<span style="color:#f92672">)).</span>getOrElse<span style="color:#f92672">(</span>log<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>socket <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">None</span><span style="color:#f92672">),</span> cmds<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">EchoSocket</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Status</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Disconnected</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">Logger</span><span style="color:#f92672">.</span>info<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;WebSocket not connected yet&#34;</span><span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> publish<span style="color:#f92672">(</span>message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Cmd</span><span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>    socket<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>publish<span style="color:#f92672">(</span>message<span style="color:#f92672">)).</span>getOrElse<span style="color:#f92672">(</span><span style="color:#a6e22e">Cmd</span><span style="color:#f92672">.</span><span style="color:#a6e22e">None</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> subscribe<span style="color:#f92672">(</span>toMessage<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">WebSocketEvent</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">Msg</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Sub</span><span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>    socket<span style="color:#f92672">.</span>fold<span style="color:#f92672">(</span><span style="color:#a6e22e">Sub</span><span style="color:#f92672">.</span>emit<span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">](</span><span style="color:#a6e22e">EchoSocket</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Status</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Disconnected</span><span style="color:#f92672">.</span>asMsg<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>subscribe<span style="color:#f92672">(</span>toMessage<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">EchoSocket</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">val</span> <span style="color:#66d9ef">init:</span> <span style="color:#66d9ef">EchoSocket</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">EchoSocket</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;wss://ws.ifelse.io/&#34;</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">None</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  enum <span style="color:#a6e22e">Status</span><span style="color:#66d9ef">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">Connecting</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Connected</span><span style="color:#f92672">(</span>ws<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">WebSocket</span><span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span><span style="color:#f92672">])</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">ConnectionError</span><span style="color:#f92672">(</span>msg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Disconnecting</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Disconnected</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> asMsg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Msg</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Msg</span><span style="color:#f92672">.</span><span style="color:#a6e22e">WebSocketStatus</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>At last, we can see how to handle socket messages and status changes in our <code>update</code> method.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> update<span style="color:#f92672">(</span>model<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Model</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Msg</span> <span style="color:#f92672">=&gt;</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">Model</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">Cmd</span><span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">])</span> <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Msg</span><span style="color:#f92672">.</span><span style="color:#a6e22e">WebSocketStatus</span><span style="color:#f92672">(</span>status<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> <span style="color:#f92672">(</span>nextWS<span style="color:#f92672">,</span> cmds<span style="color:#f92672">)</span> <span style="color:#66d9ef">=</span> model<span style="color:#f92672">.</span>echoSocket<span style="color:#f92672">.</span>update<span style="color:#f92672">(</span>status<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">(</span>model<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>echoSocket <span style="color:#66d9ef">=</span> nextWS<span style="color:#f92672">),</span> cmds<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Msg</span><span style="color:#f92672">.</span><span style="color:#a6e22e">FromSocket</span><span style="color:#f92672">(</span>message<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> logWS <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Logger</span><span style="color:#f92672">.</span>info<span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span><span style="color:#f92672">](</span><span style="color:#e6db74">&#34;Got: &#34;</span> <span style="color:#f92672">+</span> message<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">(</span>model<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>log <span style="color:#66d9ef">=</span> message <span style="color:#66d9ef">:</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">model.log</span><span style="color:#f92672">),</span> logWS<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Msg</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ToSocket</span><span style="color:#f92672">(</span>message<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> cmds<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Cmd</span><span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Cmd</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Batch</span><span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Logger</span><span style="color:#f92672">.</span>info<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Sent: &#34;</span> <span style="color:#f92672">+</span> message<span style="color:#f92672">),</span>
</span></span><span style="display:flex;"><span>        model<span style="color:#f92672">.</span>echoSocket<span style="color:#f92672">.</span>publish<span style="color:#f92672">(</span>message<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">(</span>model<span style="color:#f92672">,</span> cmds<span style="color:#f92672">)</span>
</span></span></code></pre></div><!-- raw HTML omitted -->
<p>Moreover, the <code>subscriptions</code> method handles Web Socket events.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> subscriptions<span style="color:#f92672">(</span>model<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Model</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Sub</span><span style="color:#f92672">[</span><span style="color:#66d9ef">IO</span>, <span style="color:#66d9ef">Msg</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">.</span>echoSocket<span style="color:#f92672">.</span>subscribe <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">WebSocketEvent</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Error</span><span style="color:#f92672">(</span>errorMesage<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Msg</span><span style="color:#f92672">.</span><span style="color:#a6e22e">FromSocket</span><span style="color:#f92672">(</span>errorMesage<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">WebSocketEvent</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Receive</span><span style="color:#f92672">(</span>message<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Msg</span><span style="color:#f92672">.</span><span style="color:#a6e22e">FromSocket</span><span style="color:#f92672">(</span>message<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">WebSocketEvent</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Open</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Msg</span><span style="color:#f92672">.</span><span style="color:#a6e22e">FromSocket</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&lt;no message - socket opened&gt;&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">WebSocketEvent</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Close</span><span style="color:#f92672">(</span>code<span style="color:#f92672">,</span> reason<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Msg</span><span style="color:#f92672">.</span><span style="color:#a6e22e">FromSocket</span><span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;&lt;socket closed&gt; - code: </span><span style="color:#e6db74">$code</span><span style="color:#e6db74">, reason: </span><span style="color:#e6db74">$reason</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">WebSocketEvent</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Heartbeat</span> <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Msg</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ToSocket</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&lt;💓 heartbeat 💓&gt;&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><!-- raw HTML omitted -->
<p>The full code can be found on the examples linked at the top.</p>
<p>Furthermore, you may also find the <a href="https://github.com/gvolpe/trading/tree/main/modules/ws-client">trading project</a> useful: a full-stack application with a Web Socket client sharing the back-end domain model.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1675541392"></script>
    <script src="/js/perfect-scrollbar.min.js?1675541392"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1675541392"></script>
    <script src="/js/jquery.sticky.js?1675541392"></script>
    <script src="/js/featherlight.min.js?1675541392"></script>
    <script src="/js/highlight.pack.js?1675541392"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1675541392"></script>
    <script src="/js/learn.js?1675541392"></script>
    <script src="/js/hugo-learn.js?1675541392"></script>
    
    

  </body>
</html>

