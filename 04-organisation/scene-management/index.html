<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>What are Scenes?</title>
  
  
  <meta name="description" content="A 2D Pixel Art FP game engine for Scala."/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/svg+xml" href="../../img/indigo_logo_solid.svg"/>
  
  <link rel="icon" sizes="64x64" type="image/svg+xml" href="../../img/indigo_logo_solid.svg"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../../css/custom.css" />
  <script src="../../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="../../"><img src="../../img/indigo_logo_solid_text.svg" alt="Homepage" title="Indigo" width="150" height="50"></a>

  <div class="row links">
    
    <a class="button-link" href="https://discord.gg/b5CD47g">Discord</a>
    
    <a class="button-link" href="/api">API</a>
    
    <a class="button-link" href="https://github.com/PurpleKingdomGames/indigo">Github</a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="button-link" href="https://discord.gg/b5CD47g">Discord</a>
    
    <a class="button-link" href="/api">API</a>
    
    <a class="button-link" href="https://github.com/PurpleKingdomGames/indigo">Github</a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../table-of-content/">Contents</a></li>
    <li class="level1 nav-header">Setup &amp; Configuration</li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/examples/">Examples, Demos, and References</a></li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/extensions-and-libs/">Extensions, Libraries, and Related Projects</a></li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/hello-indigo/">Hello, Indigo!</a></li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/project-templates/">Mill &amp; SBT Templates</a></li>
    <li class="level2 nav-leaf"><a href="../../01-quickstart/quickstart/">Quick start</a></li>
    <li class="level1 nav-header">Guides</li>
    <li class="level2 nav-leaf"><a href="../../02-guides/howto-custom-entity/">How to make a custom entity</a></li>
    <li class="level2 nav-leaf"><a href="../../02-guides/howto-fire-shader/">How to write a fire shader</a></li>
    <li class="level2 nav-leaf"><a href="../../02-guides/howto-hello-indigo-tyrian/">How to make a responsive UI using Tyrian</a></li>
    <li class="level2 nav-leaf"><a href="../../02-guides/howto-indigo-game/">Converting <code>IndigoSandbox</code> to <code>IndigoGame</code></a></li>
    <li class="level1 nav-header">Gameloop</li>
    <li class="level2 nav-leaf"><a href="../../03-gameloop/events/">Events</a></li>
    <li class="level2 nav-leaf"><a href="../../03-gameloop/frame-context/">Frame context</a></li>
    <li class="level2 nav-leaf"><a href="../../03-gameloop/outcome/">Outcome Type</a></li>
    <li class="level1 nav-header">Organisation</li>
    <li class="level2 nav-leaf"><a href="../boot-and-start-up/">Boot &amp; Start Up</a></li>
    <li class="level2 nav-leaf"><a href="../game-entry-points/">Game Entry Points</a></li>
    <li class="level2 active nav-leaf"><a href="#">What are Scenes?</a></li>
    <li class="level2 nav-leaf"><a href="../subsystems/">What SubSystems are</a></li>
    <li class="level1 nav-header">Platform &amp; IO</li>
    <li class="level2 nav-leaf"><a href="../../05-platform/assets/">Assets &amp; Asset Loading</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/configuration/">Game Configuration</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/cross-platform-publishing/">Cross Platform Publishing</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/importers/">File Importers</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/input-handling/">Input Handling</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/loading-and-saving-data/">Loading &amp; Saving Data</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/logging/">Logging</a></li>
    <li class="level2 nav-leaf"><a href="../../05-platform/networking/">Networking</a></li>
    <li class="level1 nav-header">Presentation</li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/animation/">Animation</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/audio/">Audio</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/boundaries/">Boundaries</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/cameras/">Cameras</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/clones-and-mutants/">Clones &amp; Mutants</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/depth/">Depth</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/layers/">Layers</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/lighting/">Lighting</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/materials/">Materials</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/primitives/">Primitives &amp; Building Blocks</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/scene-update-fragment/">SceneUpdateFragment</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/shapes/">Shapes</a></li>
    <li class="level2 nav-leaf"><a href="../../06-presentation/text-and-fonts/">Text &amp; Fonts</a></li>
    <li class="level1 nav-header">Shaders</li>
    <li class="level2 nav-leaf"><a href="../../07-shaders/blending/">Blending</a></li>
    <li class="level2 nav-leaf"><a href="../../07-shaders/constants/">Shader Constants, Variables, and Outputs</a></li>
    <li class="level2 nav-leaf"><a href="../../07-shaders/premultiplied-alpha/">Premultiplied Alpha</a></li>
    <li class="level2 nav-leaf"><a href="../../07-shaders/shaders-overview/">Shaders Overview</a></li>
    <li class="level1 nav-header">Time</li>
    <li class="level2 nav-leaf"><a href="../../08-time/gametime/">GameTime</a></li>
    <li class="level2 nav-leaf"><a href="../../08-time/signals/">Signals &amp; Signal Functions</a></li>
    <li class="level2 nav-leaf"><a href="../../08-time/time-varying-values/">Time Varying Values</a></li>
    <li class="level1 nav-header">UI Components</li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/button/">Buttons</a></li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/hit-area/">Hit Areas</a></li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/input-field/">Input Fields</a></li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/radio-button/">Radio Buttons</a></li>
    <li class="level2 nav-leaf"><a href="../../09-uicomponents/ui-components/">UI Components</a></li>
    <li class="level1 nav-header">Misc</li>
    <li class="level2 nav-leaf"><a href="../../10-information/alternatives/">Alternatives to Indigo</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/antipatterns/">Anti-Patterns</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/glossary/">Glossary</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/key-concepts/">Key Concepts</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/model-viewmodel-view/">Model, ViewModel, &amp; View</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/motivation-and-constraints/">Motivation &amp; Constraints</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/pathfinding/">Path finding</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/performance/">Performance</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/prior-art/">Prior Art</a></li>
    <li class="level2 nav-leaf"><a href="../../10-information/rendering-technology/">Rendering Technology</a></li>
    <li class="level1 nav-header">Physics</li>
    <li class="level2 nav-leaf"><a href="../../11-physics/physics-overview/">Physics Overview</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">What are Scenes?</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#working-example-snake">Working example: &quot;Snake!&quot;</a></li>
    <li class="level1 nav-leaf"><a href="#a-quick-look-under-the-hood">A quick look under the hood</a></li>
    <li class="level1 nav-leaf"><a href="#building-a-game-with-scenes">Building a game with Scenes</a></li>
    <li class="level1 nav-leaf"><a href="#building-a-scene">Building a Scene</a></li>
    <li class="level1 nav-leaf"><a href="#funny-types">Funny types</a></li>
    <li class="level1 nav-leaf"><a href="#navigating-between-scenes">Navigating between scenes</a></li>
    <li class="level1 nav-node"><a href="#state-handling-with-lenses">State handling with Lenses</a></li>
    <li class="level2 nav-leaf"><a href="#lenses">Lenses</a></li>
    <li class="level2 nav-leaf"><a href="#lens-composition">Lens composition</a></li>
    <li class="level2 nav-leaf"><a href="#limitations">Limitations</a></li>
    <li class="level1 nav-leaf"><a href="#global-operations">Global operations</a></li>
    <li class="level1 nav-node"><a href="#tips-for-working-with-scenes">Tips for working with Scenes</a></li>
    <li class="level2 nav-leaf"><a href="#passing-events-between-scenes">Passing events between scenes</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <hr>
        <p>id: scene-management
        title: Scenes &amp; Scene Management
        ---</p>
        <h1 id="what-are-scenes" class="title">What are Scenes?</h1>
        <p>As soon as you decide to build a game of any complexity, you immediately hit the problem of how to organize your code so that everything isn&#39;t lumped together. What you&#39;d really like, hopefully, is a nice way to think about each part of your game in logical groups of state and functions i.e. All the things to do with your menu screen in one place, separated from your game over screen.</p>
        <p>Most game engines have some sort of concept for these groupings, they&#39;re often called scenes, and Indigo is no exception.</p>
        
        <h2 id="working-example-snake" class="section"><a class="anchor-link left" href="#working-example-snake"><i class="icofont-laika link">&#xef71;</i></a>Working example: &quot;Snake!&quot;</h2>
        <p>If you&#39;d like to dive right in, the Snake implementation uses scenes to manage it&#39;s screens. To help you find your way around, here are a few points of interest:</p>
        <ul>
          <li>
            <p>Initial declaration of the <a href="https://github.com/PurpleKingdomGames/indigo/blob/master/demos/snake/snake/src/snake/SnakeGame.scala#L19">list of scenes</a>.</p>
          </li>
          <li>
            <p>The &quot;Start&quot; <a href="https://github.com/PurpleKingdomGames/indigo/blob/master/demos/snake/snake/src/snake/scenes/StartScene.scala">scene</a>, which is one of the simpler scenes in the game.</p>
          </li>
          <li>
            <p>The point where the &quot;Start&quot; scene decides to <a href="https://github.com/PurpleKingdomGames/indigo/blob/master/demos/snake/snake/src/snake/scenes/StartScene.scala#L40">jump</a> to the &quot;Controls&quot; scene (where the player chooses a keyboard layout) after the space bar has been pressed.</p>
          </li>
        </ul>
        
        <h2 id="a-quick-look-under-the-hood" class="section"><a class="anchor-link left" href="#a-quick-look-under-the-hood"><i class="icofont-laika link">&#xef71;</i></a>A quick look under the hood</h2>
        <p>Scenes give the appearance of building a separate game per scene, with only a nod to the underlying mechanics.</p>
        <p>The way it works, is that all scene data for every scene is held in the game&#39;s model and you provide a way to take it out and put it back again (known as a lens). Then the normal game update and presentation functions are delegated to the currently running scene, and scene navigation is controlled by events. That&#39;s it.</p>
        <blockquote>In fact, you could build you&#39;re own scene system right on top of one of Indigo&#39;s other entry points if you were so inclined.</blockquote>
        
        <h2 id="building-a-game-with-scenes" class="section"><a class="anchor-link left" href="#building-a-game-with-scenes"><i class="icofont-laika link">&#xef71;</i></a>Building a game with Scenes</h2>
        <p>To use scenes, you need to use the <code>IndigoGame</code> entry point (extend an object in the usual way and fill in the blanks), which builds on <code>IndigoDemo</code> (which builds on <code>IndigoSandbox</code>) and adds the additional mechanics for using scenes.</p>
        <p>The <code>IndigoGame</code> entry point looks almost the same as <code>IndigoDemo</code>, but adds these functions:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">indigo</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">indigo</span><span>.</span><span class="identifier">scenes</span><span>.*

</span><span class="comment">// Just examples
</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">BootData</span><span>(</span><span class="identifier">debugModeOn</span><span>: </span><span class="type-name">Boolean</span><span>)
</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">StartUpData</span><span>(</span><span class="identifier">viewport</span><span>: </span><span class="type-name">Size</span><span>)
</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Model</span><span>(</span><span class="identifier">inventory</span><span>: </span><span class="type-name">List</span><span>[</span><span class="type-name">String</span><span>])
</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">ViewModel</span><span>(</span><span class="identifier">items</span><span>: </span><span class="type-name">List</span><span>[</span><span class="type-name">String</span><span>])

</span><span class="keyword">def</span><span> </span><span class="declaration-name">scenes</span><span>(</span><span class="identifier">bootData</span><span>: </span><span class="type-name">BootData</span><span>): </span><span class="type-name">NonEmptyList</span><span>[</span><span class="type-name">Scene</span><span>[</span><span class="type-name">StartUpData</span><span>, </span><span class="type-name">Model</span><span>, </span><span class="type-name">ViewModel</span><span>]] = ???
</span><span class="keyword">def</span><span> </span><span class="declaration-name">initialScene</span><span>(</span><span class="identifier">bootData</span><span>: </span><span class="type-name">BootData</span><span>): </span><span class="type-name">Option</span><span>[</span><span class="type-name">SceneName</span><span>] = ???</span></code></pre>
        <p>These mean that you...</p>
        <ol class="arabic">
          <li>That you <em>must</em> provide an <em>ordered</em> <code>NonEmptyList</code> (see below) of <code>Scenes</code>.</li>
          <li>That you <em>can</em> provide the name of the first scene Indigo should use, otherwise the scene at the head of the list will be used.</li>
        </ol>
        
        <h2 id="building-a-scene" class="section"><a class="anchor-link left" href="#building-a-scene"><i class="icofont-laika link">&#xef71;</i></a>Building a Scene</h2>
        <p>A scene is built by creating an object (or class) that extends <code>Scene[StartupData, GameModel, ViewModel]</code>. Here&#39;s the trait:</p>
        <pre><code class="nohighlight"><span class="keyword">trait</span><span> </span><span class="type-name">Scene</span><span>[</span><span class="type-name">StartUpData</span><span>, </span><span class="type-name">GameModel</span><span>, </span><span class="type-name">ViewModel</span><span>] </span><span class="identifier">derives</span><span> </span><span class="type-name">CanEqual</span><span> {
  </span><span class="keyword">type</span><span> </span><span class="type-name">SceneModel</span><span>
  </span><span class="keyword">type</span><span> </span><span class="type-name">SceneViewModel</span><span>

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">name</span><span>: </span><span class="type-name">SceneName</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">modelLens</span><span>: </span><span class="type-name">Lens</span><span>[</span><span class="type-name">GameModel</span><span>, </span><span class="type-name">SceneModel</span><span>]
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">viewModelLens</span><span>: </span><span class="type-name">Lens</span><span>[</span><span class="type-name">ViewModel</span><span>, </span><span class="type-name">SceneViewModel</span><span>]
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">eventFilters</span><span>: </span><span class="type-name">EventFilters</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">subSystems</span><span>: </span><span class="type-name">Set</span><span>[</span><span class="type-name">SubSystem</span><span>[</span><span class="type-name">GameModel</span><span>]]

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">updateModel</span><span>(</span><span class="identifier">context</span><span>: </span><span class="type-name">SceneContext</span><span>[</span><span class="type-name">StartUpData</span><span>], </span><span class="identifier">model</span><span>: </span><span class="type-name">SceneModel</span><span>): </span><span class="type-name">GlobalEvent</span><span> =&gt; </span><span class="type-name">Outcome</span><span>[</span><span class="type-name">SceneModel</span><span>]
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">updateViewModel</span><span>(</span><span class="identifier">context</span><span>: </span><span class="type-name">SceneContext</span><span>[</span><span class="type-name">StartUpData</span><span>], </span><span class="identifier">model</span><span>: </span><span class="type-name">SceneModel</span><span>, </span><span class="identifier">viewModel</span><span>: </span><span class="type-name">SceneViewModel</span><span>): </span><span class="type-name">GlobalEvent</span><span> =&gt; </span><span class="type-name">Outcome</span><span>[</span><span class="type-name">SceneViewModel</span><span>]
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">present</span><span>(</span><span class="identifier">context</span><span>: </span><span class="type-name">SceneContext</span><span>[</span><span class="type-name">StartUpData</span><span>], </span><span class="identifier">model</span><span>: </span><span class="type-name">SceneModel</span><span>, </span><span class="identifier">viewModel</span><span>: </span><span class="type-name">SceneViewModel</span><span>): </span><span class="type-name">Outcome</span><span>[</span><span class="type-name">SceneUpdateFragment</span><span>]
}</span></code></pre>
        <div id="mdoc-html-run1" data-mdoc-js></div>
        <p>As you can hopefully see, mostly this is very much like a normal game, but for a few exceptions:</p>
        <ol class="arabic">
          <li>No initialization, animations or fonts, that all happens in the main game (shown in the previous section).</li>
          <li>Scenes have a name, which is important for navigation.</li>
          <li>Scenes have their own models and view models, more on that later.</li>
          <li>The game can have global sub systems, and scenes can also have their own subsystems too.</li>
        </ol>
        
        <h2 id="funny-types" class="section"><a class="anchor-link left" href="#funny-types"><i class="icofont-laika link">&#xef71;</i></a>Funny types</h2>
        <p>There&#39;s a couple of funny types in the code snippets above, namely <code>NonEmptyList</code> and <code>Lens</code>. The main thing to stress (if you&#39;re familiar with them already) is that they are minimal implementations within Indigo itself, and not the fully featured versions you might find in specialist libraries.</p>
        <p>This choice - right or wrong - was made because most of Indigo is vanilla Scala* and requires nothing out of the ordinary to work beyond Scala.js, but just occasionally we can do much better with a cleverer type.</p>
        <p>The two used above are <code>NonEmptyList</code> and <code>Lens</code>. The latter is discussed in the next section. A <code>NonEmptyList</code> is a <code>List</code> that cannot be empty, i.e. it will always have at least one element, and so the normally unsafe (i.e. throws an exception if the list is empty) <code>.head</code> method becomes a safe operation. You can think of the encoding as being like this:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">NonEmptyList</span><span>[</span><span class="type-name">A</span><span>](</span><span class="identifier">head</span><span>: </span><span class="type-name">A</span><span>, </span><span class="identifier">tail</span><span>: </span><span class="type-name">List</span><span>[</span><span class="type-name">A</span><span>]) {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">toList</span><span>: </span><span class="type-name">List</span><span>[</span><span class="type-name">A</span><span>] = </span><span class="identifier">head</span><span> :: </span><span class="identifier">tail</span><span>
}</span></code></pre>
        <div id="mdoc-html-run2" data-mdoc-js></div>
        <blockquote>*There is absolutely nothing stopping you from using all your favorite libraries, such as Cats or Monocle.</blockquote>
        
        <h2 id="navigating-between-scenes" class="section"><a class="anchor-link left" href="#navigating-between-scenes"><i class="icofont-laika link">&#xef71;</i></a>Navigating between scenes</h2>
        <p>The non-empty list of scenes in the original declaration is static, and cannot be added to later in the game. It is also ordered.</p>
        <p>Here&#39;s the one from Snake:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">scenes</span><span>(</span><span class="identifier">bootData</span><span>: </span><span class="type-name">GameViewport</span><span>): </span><span class="type-name">NonEmptyList</span><span>[</span><span class="type-name">Scene</span><span>[</span><span class="type-name">SnakeStartupData</span><span>, </span><span class="type-name">SnakeGameModel</span><span>, </span><span class="type-name">SnakeViewModel</span><span>]] =
    </span><span class="type-name">NonEmptyList</span><span>(</span><span class="type-name">StartScene</span><span>, </span><span class="type-name">ControlsScene</span><span>, </span><span class="type-name">GameScene</span><span>, </span><span class="type-name">GameOverScene</span><span>)</span></code></pre>
        <p>Snake also declares it&#39;s initial scene like this:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">initialScene</span><span>(</span><span class="identifier">bootData</span><span>: </span><span class="type-name">GameViewport</span><span>): </span><span class="type-name">Option</span><span>[</span><span class="type-name">SceneName</span><span>] = </span><span class="type-name">Option</span><span>(</span><span class="type-name">StartScene</span><span>.</span><span class="identifier">name</span><span>)</span></code></pre>
        <p>But this isn&#39;t actually necessary since <code>StartScene</code> is at the head of the list.</p>
        <p>To move between scenes you use events, defined simply as:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">enum</span><span> </span><span class="type-name">SceneEvent</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">GlobalEvent</span><span>:
  </span><span class="keyword">case</span><span> </span><span class="type-name">Next</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">SceneEvent</span><span>
  </span><span class="keyword">case</span><span> </span><span class="type-name">Previous</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">SceneEvent</span><span>
  </span><span class="keyword">case</span><span> </span><span class="type-name">JumpTo</span><span>(</span><span class="identifier">name</span><span>: </span><span class="type-name">SceneName</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">SceneEvent</span><span>
  </span><span class="keyword">case</span><span> </span><span class="type-name">SceneChange</span><span>(</span><span class="identifier">from</span><span>: </span><span class="type-name">SceneName</span><span>, </span><span class="identifier">to</span><span>: </span><span class="type-name">SceneName</span><span>, </span><span class="identifier">at</span><span>: </span><span class="type-name">Seconds</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">SceneEvent</span></code></pre>
        <div id="mdoc-html-run3" data-mdoc-js></div>
        <p><code>Next</code> and <code>Previous</code> proceed forwards and backwards respectively through the list of scenes until they run out. They do not loop back on themselves.</p>
        <p><code>JumpTo</code> moves to whichever scene you specify with the <code>SceneName</code>. This turns out of be very convenient since scenes are normally objects, and you can just call something like <code>JumpTo(GameOverScene.name)</code>.</p>
        
        <h2 id="state-handling-with-lenses" class="section"><a class="anchor-link left" href="#state-handling-with-lenses"><i class="icofont-laika link">&#xef71;</i></a>State handling with Lenses</h2>
        <p>The final thing to know about with <code>Scene</code>s, is how they manage state.</p>
        <p>Essentially the model of the game contains the state for all scenes. This applies to both model and view model, but we&#39;ll just talk about the model from now on. Consider a game with the following model:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">MenuModel</span><span>(</span><span class="identifier">menuItems</span><span>: </span><span class="type-name">List</span><span>[</span><span class="type-name">String</span><span>])
</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">LevelModel</span><span>(</span><span class="identifier">health</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">inventory</span><span>: </span><span class="type-name">Map</span><span>[</span><span class="type-name">String</span><span>, </span><span class="type-name">Int</span><span>])
</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">DungeonGameModel</span><span>(</span><span class="identifier">menuScene</span><span>: </span><span class="type-name">MenuModel</span><span>, </span><span class="identifier">level</span><span>: </span><span class="type-name">LevelModel</span><span>)

</span><span class="keyword">val</span><span> </span><span class="identifier">level</span><span>: </span><span class="type-name">LevelModel</span><span> = </span><span class="type-name">LevelModel</span><span>(</span><span class="number-literal">10</span><span>, </span><span class="type-name">Map</span><span>(</span><span class="string-literal">&quot;health potions&quot;</span><span> -&gt; </span><span class="number-literal">3</span><span>))
</span><span class="keyword">val</span><span> </span><span class="identifier">model</span><span>: </span><span class="type-name">DungeonGameModel</span><span> = </span><span class="type-name">DungeonGameModel</span><span>(</span><span class="type-name">MenuModel</span><span>(</span><span class="type-name">List</span><span>(</span><span class="string-literal">&quot;Press space to start!&quot;</span><span>)), </span><span class="identifier">level</span><span>)</span></code></pre>
        <p>Here is a simple lens that will extract the <code>LevelModel</code> from the <code>DungeonGameModel</code> and put it back again:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">Lens</span><span>[</span><span class="type-name">DungeonGameModel</span><span>, </span><span class="type-name">LevelModel</span><span>](
  </span><span class="identifier">getter</span><span> = (</span><span class="identifier">model</span><span>: </span><span class="type-name">DungeonGameModel</span><span>) =&gt; </span><span class="identifier">model</span><span>.</span><span class="identifier">level</span><span>,
  </span><span class="identifier">setter</span><span> = (</span><span class="identifier">model</span><span>: </span><span class="type-name">DungeonGameModel</span><span>, </span><span class="identifier">nextLevel</span><span>: </span><span class="type-name">LevelModel</span><span>) =&gt; </span><span class="identifier">model</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">level</span><span> = </span><span class="identifier">nextLevel</span><span>)
)</span></code></pre>
        <div id="mdoc-html-run5" data-mdoc-js></div>
        <p>Let&#39;s declare a scene that is using this fictional model:</p>
        <pre><code class="nohighlight"><span class="keyword">object</span><span> </span><span class="type-name">LevelScene</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">Scene</span><span>[</span><span class="type-name">Unit</span><span>, </span><span class="type-name">DungeonGameModel</span><span>, </span><span class="type-name">Unit</span><span>]:
  </span><span class="keyword">type</span><span> </span><span class="type-name">SceneModel</span><span> = </span><span class="type-name">LevelModel</span><span>
  </span><span class="keyword">type</span><span> </span><span class="type-name">SceneViewModel</span><span> = </span><span class="type-name">Unit</span><span>

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">eventFilters</span><span>: </span><span class="type-name">EventFilters</span><span> = </span><span class="type-name">EventFilters</span><span>.</span><span class="type-name">Permissive</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">modelLens</span><span>: </span><span class="type-name">Lens</span><span>[</span><span class="type-name">DungeonGameModel</span><span>, </span><span class="type-name">LevelModel</span><span>] = </span><span class="type-name">Lens</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">level</span><span>, (</span><span class="identifier">m</span><span>, </span><span class="identifier">lvl</span><span>) =&gt; </span><span class="identifier">m</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">level</span><span> = </span><span class="identifier">lvl</span><span>))
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">viewModelLens</span><span>: </span><span class="type-name">Lens</span><span>[</span><span class="type-name">Unit</span><span>, </span><span class="type-name">Unit</span><span>] = </span><span class="type-name">Lens</span><span>.</span><span class="identifier">unit</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">name</span><span>: </span><span class="type-name">SceneName</span><span> = </span><span class="type-name">SceneName</span><span>(</span><span class="string-literal">&quot;level&quot;</span><span>)
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">subSystems</span><span>: </span><span class="type-name">Set</span><span>[</span><span class="type-name">SubSystem</span><span>[</span><span class="type-name">DungeonGameModel</span><span>]] = </span><span class="type-name">Set</span><span>()

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">updateModel</span><span>(</span><span class="identifier">context</span><span>: </span><span class="type-name">SceneContext</span><span>[</span><span class="type-name">Unit</span><span>], </span><span class="identifier">model</span><span>: </span><span class="type-name">LevelModel</span><span>): </span><span class="type-name">GlobalEvent</span><span> =&gt; </span><span class="type-name">Outcome</span><span>[</span><span class="type-name">LevelModel</span><span>] =
    </span><span class="identifier">_</span><span> =&gt; </span><span class="type-name">Outcome</span><span>(</span><span class="identifier">model</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">health</span><span> = </span><span class="identifier">model</span><span>.</span><span class="identifier">health</span><span> + </span><span class="number-literal">1</span><span>)) </span><span class="comment">// On any event, increase health!
</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">updateViewModel</span><span>(</span><span class="identifier">context</span><span>: </span><span class="type-name">SceneContext</span><span>[</span><span class="type-name">Unit</span><span>], </span><span class="identifier">model</span><span>: </span><span class="type-name">LevelModel</span><span>, </span><span class="identifier">viewModel</span><span>: </span><span class="type-name">Unit</span><span>): </span><span class="type-name">GlobalEvent</span><span> =&gt; </span><span class="type-name">Outcome</span><span>[</span><span class="type-name">Unit</span><span>] =
    </span><span class="identifier">_</span><span> =&gt; </span><span class="type-name">Outcome</span><span>(</span><span class="identifier">viewModel</span><span>)

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">present</span><span>(</span><span class="identifier">context</span><span>: </span><span class="type-name">SceneContext</span><span>[</span><span class="type-name">Unit</span><span>], </span><span class="identifier">model</span><span>: </span><span class="type-name">LevelModel</span><span>, </span><span class="identifier">viewModel</span><span>: </span><span class="type-name">Unit</span><span>): </span><span class="type-name">Outcome</span><span>[</span><span class="type-name">SceneUpdateFragment</span><span>] =
    </span><span class="type-name">Outcome</span><span>(</span><span class="type-name">SceneUpdateFragment</span><span>.</span><span class="identifier">empty</span><span>)</span></code></pre>
        <div id="mdoc-html-run6" data-mdoc-js></div>
        <p>Notice that the <code>modelLens</code> uses a shorter version of the same lens we wrote earlier, but it&#39;s the same thing.</p>
        <p>Now when we run the game, the scene manager uses the lens to extract <code>LevelModel</code> from the <code>DungeonGameModel</code>, <code>updateModel</code> function updates the <code>LevelModel</code>, and then the scene manager uses the lens again to replace the old version with the new one.</p>
        
        <h3 id="lenses" class="section"><a class="anchor-link left" href="#lenses"><i class="icofont-laika link">&#xef71;</i></a>Lenses</h3>
        <p>To formalize this sort of relationship, Indigo has a just-about-good-enough <code>Lens</code> implementation (there are no prisms or anything fancy). Lenses are a really interesting subject and if you&#39;d like to know more you could take a look at something like <a href="https://github.com/optics-dev/Monocle">Monocle</a>.</p>
        <p>An Indigo lens implements a <code>get</code> and a <code>set</code> function, like so:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">get</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">from</span><span>: </span><span class="type-name">A</span><span>): </span><span class="type-name">B</span><span> = ???
</span><span class="keyword">def</span><span> </span><span class="declaration-name">set</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">into</span><span>: </span><span class="type-name">A</span><span>, </span><span class="identifier">value</span><span>: </span><span class="type-name">B</span><span>): </span><span class="type-name">A</span><span> = ???</span></code></pre>
        <div id="mdoc-html-run7" data-mdoc-js></div>
        <ul>
          <li><code>get</code> looks at, in our case, <code>DungeonGameModel</code> and extracts / returns <code>LevelModel</code>.</li>
          <li><code>set</code> puts a <code>LevelModel</code> into a <code>DungeonGameModel</code> and returns the new <code>DungeonGameModel</code> instance.</li>
        </ul>
        <p>Lets try it out! Lets start with the simple <code>copy</code> example from earlier:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">modelLens</span><span> =
  </span><span class="type-name">Lens</span><span>[</span><span class="type-name">DungeonGameModel</span><span>, </span><span class="type-name">LevelModel</span><span>](
    </span><span class="identifier">getter</span><span> = (</span><span class="identifier">model</span><span>: </span><span class="type-name">DungeonGameModel</span><span>) =&gt; </span><span class="identifier">model</span><span>.</span><span class="identifier">level</span><span>,
    </span><span class="identifier">setter</span><span> = (</span><span class="identifier">model</span><span>: </span><span class="type-name">DungeonGameModel</span><span>, </span><span class="identifier">nextLevel</span><span>: </span><span class="type-name">LevelModel</span><span>) =&gt; </span><span class="identifier">model</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">level</span><span> = </span><span class="identifier">nextLevel</span><span>)
  )

</span><span class="identifier">modelLens</span><span>.</span><span class="identifier">get</span><span>(</span><span class="identifier">model</span><span>) </span><span class="comment">// LevelModel
</span><span class="identifier">modelLens</span><span>.</span><span class="identifier">set</span><span>(</span><span class="identifier">model</span><span>, </span><span class="identifier">level</span><span>) </span><span class="comment">// DungeonGameModel</span></code></pre>
        <div id="mdoc-html-run8" data-mdoc-js></div>
        <p>You can also do things like construct temporary models by aggregating several parts of the main model into a one-shot case class, that you than de-construct and discard at the end of the frame when putting the values back.</p>
        
        <h3 id="lens-composition" class="section"><a class="anchor-link left" href="#lens-composition"><i class="icofont-laika link">&#xef71;</i></a>Lens composition</h3>
        <p>We can also posed the question of how you update things inside other things, for this we have to compose lenses together using the <code>andThen</code> operator, for example:</p>
        <pre><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Sword</span><span>(</span><span class="identifier">shininess</span><span>: </span><span class="type-name">Int</span><span>)
</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Weapons</span><span>(</span><span class="identifier">sword</span><span>: </span><span class="type-name">Sword</span><span>)
</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Inventory</span><span>(</span><span class="identifier">weapons</span><span>: </span><span class="type-name">Weapons</span><span>)

</span><span class="keyword">val</span><span> </span><span class="identifier">inventoryLens</span><span>: </span><span class="type-name">Lens</span><span>[</span><span class="type-name">Inventory</span><span>, </span><span class="type-name">Weapons</span><span>] =
  </span><span class="type-name">Lens</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">weapons</span><span>, (</span><span class="identifier">i</span><span>, </span><span class="identifier">w</span><span>) =&gt; </span><span class="identifier">i</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">weapons</span><span> = </span><span class="identifier">w</span><span>))

</span><span class="keyword">val</span><span> </span><span class="identifier">weaponsLens</span><span>: </span><span class="type-name">Lens</span><span>[</span><span class="type-name">Weapons</span><span>, </span><span class="type-name">Sword</span><span>] =
  </span><span class="type-name">Lens</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">sword</span><span>, (</span><span class="identifier">w</span><span>, </span><span class="identifier">s</span><span>) =&gt; </span><span class="identifier">w</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">sword</span><span> = </span><span class="identifier">s</span><span>))

</span><span class="keyword">val</span><span> </span><span class="identifier">inventory</span><span>     = </span><span class="type-name">Inventory</span><span>(</span><span class="type-name">Weapons</span><span>(</span><span class="type-name">Sword</span><span>(</span><span class="number-literal">1</span><span>)))
</span><span class="keyword">val</span><span> </span><span class="identifier">betterSword</span><span>   = </span><span class="type-name">Sword</span><span>(</span><span class="number-literal">2</span><span>)

</span><span class="keyword">val</span><span> </span><span class="identifier">mySwordLens</span><span> = 
  </span><span class="identifier">inventoryLens</span><span> </span><span class="identifier">`andThen`</span><span> </span><span class="identifier">weaponsLens</span><span> </span><span class="comment">// Composing lenses!
</span><span>
</span><span class="identifier">mySwordLens</span><span>.</span><span class="identifier">get</span><span>(</span><span class="identifier">inventory</span><span>) </span><span class="comment">// a sword
</span><span class="identifier">mySwordLens</span><span>.</span><span class="identifier">set</span><span>(</span><span class="identifier">inventory</span><span>, </span><span class="identifier">betterSword</span><span>) </span><span class="comment">// an inventory with a better sword in it
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">polishTheSword</span><span>: </span><span class="type-name">Sword</span><span> =&gt; </span><span class="type-name">Sword</span><span> = </span><span class="identifier">s</span><span> =&gt; </span><span class="identifier">s</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">shininess</span><span> = </span><span class="identifier">s</span><span>.</span><span class="identifier">shininess</span><span> + </span><span class="number-literal">1</span><span>)

</span><span class="identifier">mySwordLens</span><span>.</span><span class="identifier">modify</span><span>(</span><span class="identifier">inventory</span><span>, </span><span class="identifier">polishTheSword</span><span>)
</span><span class="comment">// modify is the just the composition of get, set, and a function f.</span></code></pre>
        <div id="mdoc-html-run9" data-mdoc-js></div>
        
        <h3 id="limitations" class="section"><a class="anchor-link left" href="#limitations"><i class="icofont-laika link">&#xef71;</i></a>Limitations</h3>
        <p>As with all things in Indigo, the <code>Lens</code> implementation is the bare minimum needed - if you assume most models are just nested objects - and does not currently support things like prisms.</p>
        <p>No doubt extra functionality will be added as soon as the need arises, but in the meantime, note that Indigo&#39;s lens definition says nothing about how it&#39;s implemented. If you had a complicated case, you could look at building your lenses using a Scala.js compatible lens library, and just use the Indigo Lens as an interface to the engine.</p>
        
        <h2 id="global-operations" class="section"><a class="anchor-link left" href="#global-operations"><i class="icofont-laika link">&#xef71;</i></a>Global operations</h2>
        <p>The <code>IndigoGame</code> entry point also provides the standard update and present functions that run at a global level. This wasn&#39;t in the original design because it is quite confusing! Unfortunately it&#39;s also very useful and the benefits out-weigh the complexity drawbacks.</p>
        <p><strong>The Good!</strong></p>
        <p>Example: Your model is comprised of the data needed for each level as a separate field in a case class, and you have a global inventory. You&#39;d like to be able to update both.</p>
        <p>One way to do that is with a slightly complicated lens arrangement that knows how to extract both into a temporary object that only exists for this frame, and then de-construct that object to set the new values back into the main model. That works, but it get increasingly complicated the more elements you need to draw together, and eventually the temptation is just to use the whole model, which defeats the point of having the lenses.</p>
        <p>The other way, as long as the update isn&#39;t time critical, is to emit an event! If you emit an event then the event can be caught in the next frame at the global level and the inventory can be updated. Nice and clean. As mentioned this works well for updates that aren&#39;t time critical since the effect won&#39;t be visible until the frame after next.</p>
        <p><strong>The not so good..</strong></p>
        <p>You&#39;d like to render a global UI at all times - great - this can be done with our global present function.</p>
        <p><em>...but how will that be merged with the scene&#39;s own present function?</em></p>
        <p>Well, the global view is always processed first. The idea is that you should use layers with layer keys to control output destinations since the original position of layers with keys is preserved when another layer with the same key is added to the scene.</p>
        
        <h2 id="tips-for-working-with-scenes" class="section"><a class="anchor-link left" href="#tips-for-working-with-scenes"><i class="icofont-laika link">&#xef71;</i></a>Tips for working with Scenes</h2>
        
        <h3 id="passing-events-between-scenes" class="section"><a class="anchor-link left" href="#passing-events-between-scenes"><i class="icofont-laika link">&#xef71;</i></a>Passing events between scenes</h3>
        <p>When one scene is running none of the others are, but sometimes it&#39;s useful to be able to pass a message to the scene you&#39;re about to switch to.</p>
        <p>This turns out to be very easy in Indigo. Since events are ordered and strictly evaluated, all you need to do is:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">MessageForNextScene</span><span>(</span><span class="identifier">message</span><span>: </span><span class="type-name">String</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">GlobalEvent</span><span>

</span><span class="type-name">Outcome</span><span>(</span><span class="identifier">model</span><span>) </span><span class="comment">// here, the result of a model update, but could be any Outcome
</span><span>  .</span><span class="identifier">addGlobalEvents</span><span>(
    </span><span class="type-name">SceneEvent</span><span>.</span><span class="type-name">JumpTo</span><span>(</span><span class="type-name">SceneName</span><span>(</span><span class="string-literal">&quot;next!&quot;</span><span>)),
    </span><span class="type-name">MessageForNextScene</span><span>(</span><span class="string-literal">&quot;Hello next scene!&quot;</span><span>)
  )</span></code></pre>
        <div id="mdoc-html-run10" data-mdoc-js></div>
        <p>The first event will re-route all functions to the new scene, and the next event will therefore be received immediately by that scene.
        <script type="text/javascript" src="scene-management.md.js" defer></script>
        <script type="text/javascript" src="mdoc.js" defer></script></p>

        
<hr class="footer-rule"/>
<footer>
  Site generated by <a href="https://typelevel.org/Laika/">Laika</a> with the Helium theme.
</footer>


      </main>

    </div>

  </body>

</html>